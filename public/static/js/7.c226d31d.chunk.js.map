{"version":3,"sources":["commons/click-outside-handler/useOnClickOutside.ts","commons/click-outside-handler/ClickOutsideHandler.tsx","commons/components/layouts/Sidebar.tsx","commons/components/layouts/SidebarLayout.tsx","apps/seguimiento/planes/queries/index.ts","apps/seguimiento/planes/services/PlanService.ts","apps/seguimiento/planes/services/AreaService.ts","apps/seguimiento/planes/components/RowOptions.tsx","apps/seguimiento/planes/components/PlanIndex.tsx","apps/seguimiento/planes/components/AreasTypeahead.tsx","apps/seguimiento/planes/components/PlanForm.tsx","apps/seguimiento/planes/components/ActividadRowOptions.tsx","apps/seguimiento/planes/components/PlanView.tsx","apps/seguimiento/planes/components/AvanceForm.tsx","apps/seguimiento/planes/components/HistorialRowOptions.tsx","apps/seguimiento/planes/components/ActividadView.tsx","apps/seguimiento/SeguimientoApp.tsx"],"names":["useOnClickOutside","ref","handler","useEffect","listener","event","el","current","contains","target","document","querySelector","addEventListener","removeEventListener","ClickOutsideHandler","children","onClickOutside","props","containerRef","useRef","SidebarItem","item","match","useRouteMatch","path","ListGroup","Item","as","Link","to","action","active","className","style","padding","icon","verticalAlign","marginLeft","title","id","items","map","subitem","paddingLeft","Sidebar","side","header","renderItem","left","right","variant","SidebarLayout","sidebar","showSidebar","useSelector","state","sidebarVisibility","dispatch","useDispatch","onClickOutsideHandler","React","useCallback","console","log","toggle","type","Container","queryKey","PlanService","filter","page","apiClient","get","params","keysToUnderscore","payload","post","actividadId","formData","FormData","append","String","avance","observaciones","informe","headers","AreaService","useCargarPlan","options","queryClient","useQueryClient","cargarQueryKey","getQueryState","status","planesQueryData","getQueryData","plan","data","records","find","p","setQueryData","useQuery","cargar","refetchOnWindowFocus","refetchOnReconnect","select","RowOptions","useModal","Dropdown","position","Toggle","VerticalEllipsisDropdownToggle","Menu","authorize","pathname","PlanIndex","loggedUser","useLoggedUser","useState","size","setPage","defaultFilter","useMemo","filterFormVisible","showFilterForm","buscar","useBuscarPlanes","total","meta","fontSize","Form","Row","Col","xs","Button","onClick","refetch","visible","Collapse","in","Control","value","onChange","e","parseInt","Table","responsive","width","isFetching","colSpan","Spinner","animation","isError","error","response","message","length","index","objetivoGeneral","concluido","renderRows","Math","ceil","AreasTypeahead","isInvalid","feedback","filterBy","refetchOnMount","onLoad","Array","isArray","InputGroup","hasValidation","clearButton","emptyLabel","align","regional","text","isMatch","nombre","isLoading","labelKey","Append","Feedback","schema","yup","shape","area","label","required","actividades","min","of","max","test","context","from","a","indicadores","inicio","emptyStringTo","typeError","fin","when","moment","add","toDate","PlanForm","history","useHistory","useForm","mode","resolver","yupResolver","defaultValues","control","handleSubmit","register","formState","formErrors","watch","errors","useFieldArray","name","actividadesField","fields","appendActividad","removeActividad","remove","guardar","useMutation","inputs","registrar","regionalId","areaId","actividad","toISOString","split","onSuccess","invalidateQueries","replace","onSubmit","mutate","Group","sm","Label","render","field","fieldState","selected","onBlur","minWidth","actividadField","scope","ActividadRowOptions","planId","useLocation","useParams","PlanView","Card","Header","Body","avanceEsperado","estado","isBefore","overflow","top","nullable","notRequired","AvanceForm","modalProps","reset","vars","registrarAvance","ctx","updatePlan","actual","esperado","historial","oldData","useRegistrarAvance","onHide","Modal","centered","values","disabled","format","Text","File","Footer","form","HistorialRowOptions","pdfModal","open","url","informeUrl","scales","yAxes","ticks","beginAtZero","LineChart","memo","ActividadView","avanceFormVisible","showAvanceForm","useCargarActividad","getData","first","fecha","last","subtract","hoy","startDate","endDate","isAfter","ultimoAvance","isSameOrBefore","entries","h","push","getIdealData","startOf","duration","diff","asDays","date","clone","day","round","labels","getLabels","datasets","fill","backgroundColor","borderColor","borderDash","height","locale","fromNow","show","SeguimientoApp","removeTrailingSlashes","location","sidebarItems","background","Image","src","exact"],"mappings":"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","file":"static/js/7.c226d31d.chunk.js","sourcesContent":["import { RefObject, useEffect } from 'react'\r\n\r\ntype AnyEvent = MouseEvent | TouchEvent\r\n\r\nexport function useOnClickOutside<T extends HTMLElement = HTMLElement>(\r\n  ref: RefObject<T>,\r\n  handler: (event: AnyEvent) => void,\r\n) {\r\n  useEffect(() => {\r\n    const listener = (event: AnyEvent) => {\r\n      const el = ref?.current\r\n\r\n      // Do nothing if clicking ref's element or descendent elements\r\n      if (!el || el.contains(event.target as Node) || document.querySelector('html') == event.target) {\r\n        return\r\n      }\r\n      handler(event)\r\n    }\r\n\r\n    document.addEventListener(`mousedown`, listener)\r\n    document.addEventListener(`touchstart`, listener)\r\n\r\n    return () => {\r\n      document.removeEventListener(`mousedown`, listener)\r\n      document.removeEventListener(`touchstart`, listener)\r\n    }\r\n\r\n    // Reload only if ref or handler changes\r\n  }, [ref, handler])\r\n}\r\n\r\nexport default useOnClickOutside\r\n","import { FC, useRef, ComponentProps } from 'react'\r\nimport { useOnClickOutside } from './useOnClickOutside'\r\n\r\ntype Props = {\r\n  onClickOutside: (event: MouseEvent | TouchEvent) => void\r\n} & ComponentProps<\"div\">\r\nexport const ClickOutsideHandler:FC<Props> = ({children, onClickOutside, ...props}) => {\r\n  const containerRef = useRef<HTMLDivElement>(null)\r\n  useOnClickOutside(containerRef, onClickOutside)\r\n  return <div ref={containerRef} {...props}>\r\n    {children}\r\n  </div>\r\n}","import React, { ComponentProps } from 'react'\r\nimport { ListGroup } from 'react-bootstrap';\r\nimport { Link, useRouteMatch } from 'react-router-dom'\r\n\r\ntype MenuItem = {\r\n  id: string,\r\n  title: string,\r\n  path: string,\r\n  icon?: React.ReactNode,\r\n  items?: undefined\r\n} | {\r\n  id: string,\r\n  title: string,\r\n  path?: string,\r\n  icon?: React.ReactNode,\r\n  items: {\r\n    id: string,\r\n    title: string,\r\n    path: string,\r\n    icon?: React.ReactNode,\r\n  }[]\r\n}\r\n\r\nconst SidebarItem = (item: MenuItem)=>{\r\n  const match = useRouteMatch(item.path || \"\")\r\n\r\n  return <>\r\n    {item.path ?\r\n      <ListGroup.Item as={Link} to={item.path} \r\n        action\r\n        active={!!match}\r\n        className=\"border-0 text-nowrap\"\r\n        style={{\r\n          padding: \".5rem 1rem\"\r\n        }}\r\n        key={item.id}>\r\n          {item.icon}<span style={{verticalAlign: 'middle', marginLeft: '0.5rem'}}>{item.title}</span>\r\n      </ListGroup.Item> : \r\n      <div\r\n        className=\"list-group-item border-0 text-nowrap\"\r\n        style={{\r\n          padding: \".5rem 1rem\"\r\n        }}\r\n        key={item.id}>\r\n          {item.icon}<span style={{verticalAlign: 'middle', marginLeft: '0.5rem'}}>{item.title}</span>\r\n      </div>\r\n    }\r\n    {item.items && item.items.map(subitem=>{\r\n      return <Link to={subitem.path} \r\n        style={{\r\n          padding: \".5rem 1rem\",\r\n          paddingLeft: \"2rem\"\r\n        }}\r\n        className=\"list-group-item list-group-item-action border-0 text-nowrap\" \r\n        key={subitem.id}>\r\n          {subitem.icon || null}<span style={{verticalAlign: 'middle', marginLeft: '0.5rem'}}>{subitem.title}</span>\r\n      </Link>\r\n    })}\r\n  </>\r\n}\r\n\r\nexport type SidebarProps = ComponentProps<\"div\"> & {\r\n  side?: 'left' | 'right',\r\n  header?: string | JSX.Element,\r\n  items?: MenuItem[],\r\n  renderItem?: (item: MenuItem) => JSX.Element\r\n}\r\nexport const Sidebar = (props: SidebarProps) => {\r\n  const {className=\"\", side=\"right\", header=\"\", items=[], renderItem} = props\r\n  const borderClass = {left: 'border-left', right: 'border-right'}\r\n  return <div className={`${className}  ${borderClass[side]}`} id=\"sidebar-wrapper\">\r\n    <div className=\"sidebar-heading mt-2\">{header}</div>\r\n    <hr className=\"mx-2\"></hr>\r\n    <ListGroup variant=\"flush\">\r\n      {items.map(item=>(\r\n        <SidebarItem key={item.id} {...item} />\r\n      ))}      \r\n    </ListGroup>\r\n    {/* <div className=\"list-group list-group-flush\">\r\n      {items.map(item=><a href=\"#\" className=\"list-group-item list-group-item-action\" key={item.id}>{renderItem ? renderItem(item):item.title}</a>)}\r\n    </div> */}\r\n  </div>\r\n  \r\n}","import React from 'react'\r\nimport { Container } from 'react-bootstrap'\r\nimport { useSelector, useDispatch } from 'react-redux'\r\nimport { ClickOutsideHandler } from '../../click-outside-handler'\r\nimport { Sidebar, SidebarProps } from './Sidebar'\r\nimport \"./simple-sidebar.css\"\r\n\r\ntype Props = {\r\n  sidebar: SidebarProps\r\n  children: React.ReactNode\r\n}\r\nexport const SidebarLayout = ({sidebar, children}: Props) => {\r\n  const showSidebar = useSelector((state:any) => state.sidebarVisibility)\r\n  const dispatch = useDispatch()\r\n\r\n  const onClickOutsideHandler = React.useCallback((event: MouseEvent | TouchEvent)=>{\r\n    console.log(event.target)\r\n    const toggle = document.querySelector('[aria-label=\"Toggle navigation\"]')\r\n    if(!toggle?.contains(event.target as Node)){\r\n      dispatch({\r\n        type: \"CLOSE_SIDEBAR\"\r\n      })\r\n    }\r\n  }, [showSidebar])\r\n  \r\n  return <div className={\"position-relative d-flex flex-grow-1 bg-light\" + (showSidebar ? \" toggled\" : \"\")}  id=\"wrapper\">\r\n    <ClickOutsideHandler onClickOutside={onClickOutsideHandler}>\r\n      <Sidebar className=\"bg-white shadow-sm\" {...sidebar}/>\r\n    </ClickOutsideHandler>\r\n    <Container className=\"d-flex flex-column flex-grow-1\">\r\n      <div className=\"d-flex flex-column bg-white rounded-lg shadow-sm m-2 p-3 flex-grow-1\">\r\n        {children}\r\n      </div>\r\n    </Container>\r\n  </div>\r\n}\r\n\r\nexport default SidebarLayout","import { useMemo } from 'react'\r\nimport { AxiosResponse, AxiosError } from 'axios';\r\nimport { Page, PaginatedResponse } from '../../../../commons/services'\r\nimport { QueryKey, UseMutationOptions, UseQueryOptions, UseQueryResult, useMutation, useQuery, useQueryClient } from 'react-query'\r\nimport { Avance, Actividad, Plan, PlanService, PlanFilter } from '../services'\r\n\r\nexport type { PlanFilter }\r\n\r\nlet queryKey: QueryKey;\r\n\r\nexport const useBuscarPlanes = (filter: PlanFilter, page: Page) => {\r\n  queryKey = [\"planes.buscar\", filter, page]\r\n  return useQuery(queryKey, ()=>{\r\n    return PlanService.buscar(filter, page)\r\n  }, {\r\n    refetchOnWindowFocus: false,\r\n    refetchOnReconnect: false\r\n  })\r\n}\r\n\r\nexport const useCargarPlan = (id: number, options?: UseQueryOptions<AxiosResponse<Plan>, AxiosError, Plan>) => {\r\n  const queryClient = useQueryClient()\r\n  const cargarQueryKey = [\"planes.cargar\", id]\r\n  if(queryClient.getQueryState(cargarQueryKey)?.status === 'idle'){\r\n    const planesQueryData = queryClient.getQueryData<any>(queryKey)\r\n    const plan = planesQueryData?.data.records?.find((p: Plan) => p.id === id)\r\n    if(plan) {\r\n      queryClient.setQueryData(cargarQueryKey, {\r\n        data: plan\r\n      })\r\n    }\r\n  }\r\n  const cargar = useQuery([\"planes.cargar\", id], ()=>{\r\n    return PlanService.cargar(id)\r\n  }, {\r\n    refetchOnWindowFocus: false,\r\n    refetchOnReconnect: false,\r\n    select: (data) => data.data,\r\n    ...options\r\n  })\r\n  return cargar\r\n}\r\n\r\nexport const useCargarActividad = (planId: number, actividadId: number, options?: UseQueryOptions<AxiosResponse<Plan>, AxiosError, Actividad|null>) => {\r\n  // const queryClient = useQueryClient()\r\n  // const cargarQueryKey = [\"planes.cargar\", planId]\r\n  // if(queryClient.getQueryState(cargarQueryKey)?.status === 'idle'){\r\n  //   const planesQueryData = queryClient.getQueryData<any>(queryKey)\r\n  //   const plan = planesQueryData?.data.records?.find((p: Plan) => p.id === planId)\r\n  //   if(plan) {\r\n  //     queryClient.setQueryData(cargarQueryKey, {\r\n  //       data: plan\r\n  //     })\r\n  //   }\r\n  // }\r\n  // const cargar = useQuery(cargarQueryKey, ()=>{\r\n  //   return PlanService.cargar(planId)\r\n  // }, {\r\n  //   refetchOnWindowFocus: false,\r\n  //   refetchOnReconnect: false,\r\n  //   select: (data) => data.data.actividades?.find(a => a.id == actividadId) || null,\r\n  //   ...options,\r\n  // })\r\n  \r\n  const cargar = useCargarPlan(planId, {\r\n    //@ts-ignore\r\n    select: (data) => data.data.actividades?.find(a => a.id == actividadId) || null,\r\n    //@ts-ignore\r\n    ...options\r\n  })\r\n  return cargar as UseQueryResult<Actividad, AxiosError>\r\n}\r\n\r\nexport const useRegistrarAvance = (options?: UseMutationOptions<AxiosResponse<Avance>, AxiosError, {\r\n  params: {\r\n    planId: number\r\n    actividadId: number\r\n  }\r\n  data: {\r\n    avance: number\r\n    observaciones: string\r\n    informe: File\r\n  }\r\n}>) => {\r\n  const queryClient = useQueryClient()\r\n  return useMutation((vars)=>{\r\n    const {params:{planId, actividadId}, data} = vars\r\n    return PlanService.registrarAvance(planId, actividadId, data)\r\n  }, {\r\n    ...options,\r\n    onSuccess: (data, vars, ctx)=>{\r\n      const { data: avance } = data, { params: { planId, actividadId } } = vars\r\n      options?.onSuccess && options.onSuccess(data, vars, ctx)\r\n      const updatePlan = (plan: Plan, avance: Avance) => {\r\n        const actividades = plan.actividades.map(a => {\r\n          return a.id === actividadId ? {\r\n            ...a,\r\n            avance: avance.actual,\r\n            avanceEsperado: avance.esperado,\r\n            historial: [\r\n              ...a.historial,\r\n              avance\r\n            ]\r\n          } : a\r\n        })\r\n        return {\r\n          ...oldData.data,\r\n          avance: actividades.filter(a => a.avance == 100).length,\r\n          avanceEsperado: actividades.filter(a => a.avanceEsperado == 100).length,\r\n          actividades\r\n        }\r\n      }\r\n\r\n      const oldData = queryClient.getQueryData([\"planes.cargar\", planId]) as AxiosResponse<Plan>\r\n      if(oldData) {\r\n        queryClient.setQueryData([\"planes.cargar\", planId], {\r\n          ...oldData,\r\n          data: updatePlan(oldData.data, avance)\r\n        })\r\n      }\r\n      else {\r\n        queryClient.setQueryData(queryKey, (oldData?: AxiosResponse<PaginatedResponse<Plan>>) => {\r\n          const records = oldData!.data.records.map(p => {\r\n            if(p.id === planId){\r\n              return updatePlan(p, avance)\r\n            }\r\n            return p\r\n          })\r\n          return {\r\n            ...oldData!,\r\n            data: {\r\n              ...oldData!.data,\r\n              records\r\n            }\r\n          }\r\n        })\r\n      }\r\n    }\r\n  })\r\n}","import { apiClient, Page, PaginatedResponse } from \"../../../../commons/services\"\r\nimport { keysToUnderscore } from \"../../../../commons/utils\"\r\n\r\nexport type PlanFilter = {\r\n  regionalId?: number\r\n}\r\n\r\nexport type Avance = {\r\n  id: number\r\n  fecha: string\r\n  actual: number\r\n  esperado: number,\r\n  informeUrl: string\r\n  observaciones: string\r\n}\r\n\r\nexport type Actividad = {\r\n  id: number\r\n  nombre: string\r\n  inicio: string\r\n  fin: string\r\n  avance: number\r\n  avanceEsperado: number\r\n  indicadores: string\r\n  estado: number\r\n  historial: Avance[]\r\n}\r\n\r\nexport type Plan = {\r\n  id: number\r\n  regionalId: number\r\n  areaId: number\r\n  objetivoGeneral: string\r\n  avance: number\r\n  avanceEsperado: number\r\n  concluido: boolean\r\n  actividades: Actividad[]\r\n}\r\n\r\nclass Service {\r\n  buscar(filter: PlanFilter, page: Page) {\r\n    return apiClient.get<PaginatedResponse<Plan>>('/planes', {\r\n      params: keysToUnderscore({\r\n        page,\r\n        filter\r\n      })\r\n    })\r\n  }\r\n\r\n  cargar(id: number) {\r\n    return apiClient.get<Plan>(`/planes/${id}`)\r\n  }\r\n\r\n  registrar(payload: {\r\n    regionalId: number\r\n    areaId: number\r\n    objetivoGeneral: string\r\n    actividades: {\r\n      nombre: string\r\n      indicadores: string\r\n      inicio: string\r\n      fin: string\r\n    }[]\r\n  }) {\r\n    return apiClient.post('/planes', keysToUnderscore(payload))\r\n  }\r\n  \r\n  cargarActividad(id: number, actividadId: number) {\r\n    return apiClient.get<Actividad>(`/planes/${id}/actividades/${actividadId}`)\r\n  }\r\n  \r\n  registrarAvance(id: number, actividadId: number, payload: {\r\n    avance: number,\r\n    informe: File,\r\n    observaciones: string\r\n  }) {\r\n    const formData = new FormData()\r\n    formData.append(\"avance\", String(payload.avance))\r\n    formData.append(\"observaciones\", payload.observaciones)\r\n    formData.append(\"informe\", payload.informe)\r\n    return apiClient.post<Avance>(`/planes/${id}/actividades/${actividadId}/registrar-avance`, formData, {\r\n      headers: {\r\n        'Content-Type': 'multipart/form-data'\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\nexport const PlanService = new Service()","import apiClient from \"../../../../commons/services/apiClient\"\r\n\r\nexport type Area = {\r\n  id: number,\r\n  nombre: string\r\n}\r\nexport const AreaService = {\r\n  obtener: () => {\r\n    return apiClient.get<Area[]>(\"areas\")\r\n  }\r\n}","import { useEffect } from \"react\"\r\nimport { Dropdown } from \"react-bootstrap\"\r\nimport { useMutation, useQuery, useQueryClient, QueryKey } from \"react-query\"\r\nimport { FaEye } from 'react-icons/fa'\r\nimport { Link } from \"react-router-dom\"\r\nimport { VerticalEllipsisDropdownToggle } from \"../../../../commons/components\"\r\nimport { useModal } from \"../../../../commons/reusable-modal\"\r\nimport { ProtectedContent } from \"../../../../commons/auth/components\"\r\nimport { Plan, PlanService } from \"../services\"\r\n// import { RolPolicy } from \"../policies\"\r\n\r\ntype Props = {\r\n  plan: Plan\r\n  queryKey: QueryKey\r\n}\r\nexport const RowOptions = ({plan, queryKey}: Props) => {\r\n\r\n  const modal = useModal<{\r\n    state: \"loading\" | \"error\"\r\n    error?: Error\r\n  }>(\"queryLoader\")\r\n\r\n  const queryClient = useQueryClient()\r\n\r\n  // const eliminar = useMutation((id: number)=>{\r\n  //   return RolService.eliminar(id)\r\n  // }, {\r\n  //   onSuccess: ()=>{\r\n  //     modal.close()\r\n  //     queryClient.invalidateQueries(\"roles.buscar\",{inactive: true})\r\n  //     queryClient.setQueryData(queryKey, (oldData: any) => {\r\n  //       return {\r\n  //         ...oldData,\r\n  //         data: {\r\n  //           ...oldData.data,\r\n  //           records: oldData.data.records.filter((u: any)=>{\r\n  //             return u !== rol\r\n  //           })\r\n  //         }\r\n  //       }\r\n  //     })\r\n  //   }\r\n  // })\r\n\r\n  // useEffect(()=>{\r\n  //   if(eliminar.status == \"loading\"){\r\n  //     modal.open({\r\n  //       state: \"loading\"\r\n  //     })\r\n  //   }\r\n  //   else if(eliminar.status == \"error\"){\r\n  //     modal.open({\r\n  //       state: \"error\",\r\n  //       error: eliminar.error\r\n  //     })\r\n  //   }\r\n  // }, [eliminar.status])\r\n\r\n  return <Dropdown style={{position: \"initial\"}}>\r\n    <Dropdown.Toggle as={VerticalEllipsisDropdownToggle}\r\n      variant=\"link\" id={`dropdown-planes-${plan.id}`}\r\n    />\r\n    <Dropdown.Menu>\r\n      <ProtectedContent\r\n        authorize={()=>true}\r\n      >\r\n        <Dropdown.Item as={Link} to={{\r\n          pathname: `/seguimiento/planes/${plan.id}`,\r\n          state: {\r\n            plan\r\n          }\r\n        }} ><FaEye className=\"mr-2\"/> Detalles</Dropdown.Item>\r\n      </ProtectedContent>\r\n      {/* <ProtectedContent\r\n        authorize={()=>true}\r\n      >\r\n        <Dropdown.Item as={Link} to={{\r\n          pathname: `/iam/roles/${rol.id}/editar`,\r\n          state: {\r\n            plan\r\n          }\r\n        }}>Editar</Dropdown.Item>\r\n      </ProtectedContent>\r\n      <ProtectedContent\r\n        authorize={()=>true}\r\n      >\r\n        <Dropdown.Item className=\"text-danger\" onClick={()=>{\r\n          if(window.confirm(\"Esta accion es irreversible, ¿Esta seguro de continuar?\")){\r\n            eliminar.mutate(rol.id)\r\n          }\r\n        }}>Eliminar</Dropdown.Item>\r\n      </ProtectedContent> */}\r\n    </Dropdown.Menu>\r\n  </Dropdown>\r\n}","import { AxiosError } from \"axios\"\r\nimport {useState, useRef, useEffect, useMemo} from \"react\"\r\nimport { Button, Collapse, Form, Table, Spinner, Row, Col } from \"react-bootstrap\"\r\nimport { Link } from \"react-router-dom\"\r\nimport { useQuery } from \"react-query\"\r\nimport { FaSync, FaFilter, FaUserPlus } from \"react-icons/fa\"\r\nimport { Page } from \"../../../../commons/services\"\r\nimport { Pagination } from \"../../../../commons/components\"\r\nimport { ProtectedContent } from \"../../../../commons/auth/components\"\r\nimport { Permisos } from \"../../../../commons/auth/constants\"\r\nimport { useLoggedUser } from \"../../../../commons/auth/hooks\"\r\nimport { PlanFilter, useBuscarPlanes } from \"../queries\"\r\n// import { UsuarioPolicy } from \"../policies\"\r\n// import { UserFilterForm } from \"./UserFilterForm\"\r\nimport { RowOptions } from \"./RowOptions\"\r\n\r\nexport const PlanIndex = ()=>{\r\n\r\n  const loggedUser = useLoggedUser()\r\n\r\n  const [page, setPage] = useState<Page>({\r\n    current: 1,\r\n    size: 10\r\n  })\r\n\r\n  const defaultFilter = useMemo(()=>{\r\n    const filter: PlanFilter =  {}\r\n    //TODO: Access Control\r\n    if(false){\r\n      filter.regionalId = loggedUser.regionalId\r\n    }\r\n    return filter\r\n  }, [loggedUser])\r\n\r\n  const [filter, setFilter] = useState<PlanFilter>(defaultFilter)\r\n\r\n  const [filterFormVisible, showFilterForm] = useState(false)\r\n\r\n  // const queryKey = \"planes.buscar\"\r\n  // const buscar = useQuery(queryKey, ()=>{\r\n  //   return PlanService.buscar(filter, page)\r\n  // }, {\r\n  //   // enabled: UsuarioPolicy.view(loggedUser),\r\n  //   refetchOnWindowFocus: false,\r\n  //   refetchOnReconnect: false\r\n  // })\r\n  const buscar = useBuscarPlanes(filter, page)\r\n\r\n  const total = buscar.data?.data?.meta?.total || 0\r\n\r\n  const renderRows = ()=>{\r\n    if (buscar.isFetching) {\r\n      return <tr>\r\n        <td className=\"bg-light text-center\" colSpan={100}>\r\n          <Spinner className=\"mr-2\" variant=\"primary\" animation=\"border\" size=\"sm\" />\r\n          Cargando\r\n        </td>\r\n      </tr>\r\n    }\r\n    if (buscar.isError) {\r\n      const { error } = buscar\r\n      return <tr>\r\n        <td className=\"bg-danger text-light text-center\" colSpan={100}>\r\n          {(error as AxiosError).response?.data?.message || (error as AxiosError).message}\r\n        </td>\r\n      </tr>\r\n    }\r\n    if (buscar.data){\r\n      const records = buscar.data.data.records\r\n      if(records.length == 0){\r\n        return  <tr>\r\n          <td className=\"bg-light text-center\" colSpan={100}>\r\n            No se encontraron resultados\r\n          </td>\r\n      </tr>\r\n      }\r\n      return records.map((plan, index)=>{\r\n        return <tr key={plan.id}>\r\n          <td>{index + 1}</td>\r\n          <td>{plan.objetivoGeneral}</td>\r\n          <td>{plan.concluido ? \"Sí\" : \"No\"}</td>\r\n          <td>\r\n            <RowOptions plan={plan} queryKey={[\"planes.buscar\", filter, page]} />\r\n          </td>\r\n        </tr>\r\n      })\r\n    }\r\n  }\r\n\r\n  return <div className=\"px-1\">\r\n    <h2 style={{fontSize: \"1.75rem\"}}>Planes</h2>\r\n    <div className=\"d-flex my-2\">\r\n      <Form.Row className=\"ml-auto flex-nowrap\" >\r\n        <ProtectedContent\r\n          authorize={()=>true}\r\n        >\r\n          <Col xs=\"auto\" >\r\n            <Button onClick={()=>{\r\n              buscar.refetch()\r\n            }}><FaSync /></Button>\r\n          </Col>\r\n          <Col xs=\"auto\" >\r\n            <Button onClick={()=>{\r\n              showFilterForm(visible=>!visible)\r\n            }}><FaFilter /></Button>\r\n          </Col>\r\n        </ProtectedContent>\r\n        <ProtectedContent\r\n          authorize={()=>true}\r\n        >\r\n          <Col xs=\"auto\">\r\n            <Button\r\n              as={Link}\r\n              to={`/seguimiento/planes/registrar`}\r\n              className=\"d-flex align-items-center\">\r\n                Nuevo\r\n            </Button>\r\n          </Col>\r\n        </ProtectedContent>\r\n      </Form.Row>\r\n    </div>\r\n    <ProtectedContent\r\n      authorize={()=>true}\r\n    >\r\n      <Collapse in={filterFormVisible}>\r\n        <div>\r\n          {/* <UserFilterForm onFilter={(filter)=>{\r\n            setFilter({...filter, ...defaultFilter})\r\n          }} /> */}\r\n        </div>\r\n      </Collapse>\r\n      <div className=\"d-flex\">\r\n        <div className=\"ml-auto mb-2\">          \r\n          <div className=\"d-flex flex-row flex-nowrap align-items-center\">\r\n            <span>Mostrar</span>\r\n            <Form.Control className=\"mx-2\" as=\"select\" value={page.size} onChange={(e) => {\r\n              const value = e.target.value\r\n              setPage((page) => ({\r\n                ...page,\r\n                size: parseInt(value)\r\n              }))\r\n            }}>\r\n              <option value={10}>10</option>\r\n              <option value={20}>20</option>\r\n              <option value={30}>30</option>\r\n              <option value={50}>50</option>\r\n              <option value={100}>100</option>\r\n            </Form.Control>\r\n            <span>filas</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <Table responsive>\r\n        <thead>\r\n          <tr>\r\n            <th style={{width: 1}}>#</th>\r\n            <th>Objetivo general</th>\r\n            <th>Estado</th>\r\n            <th style={{width: 1}}></th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          {renderRows()}\r\n        </tbody>\r\n      </Table>\r\n      <Row>\r\n        <Col>\r\n          <span className=\"mr-auto\">{`Se encontraron ${total} resultados`}</span>\r\n        </Col>\r\n        <Col>\r\n          <Pagination\r\n            current={page.current}\r\n            total={Math.ceil((total - page.size) / page.size) + 1}\r\n            onChange={(current) => setPage((page) => ({ ...page, current }))}\r\n          />\r\n        </Col>\r\n      </Row>\r\n    </ProtectedContent>\r\n  </div>\r\n}","\r\nimport { useEffect, useMemo } from \"react\"\r\nimport { Button, Form, InputGroup } from \"react-bootstrap\"\r\nimport { Typeahead, TypeaheadProps } from 'react-bootstrap-typeahead'\r\nimport { FaSync } from 'react-icons/fa'\r\nimport { useQuery } from 'react-query'\r\nimport { isMatch } from \"../../../../commons/utils\";\r\nimport { Area, AreaService } from \"../services\";\r\nimport 'react-bootstrap-typeahead/css/Typeahead.css';\r\n\r\nexport type { Area }\r\n\r\nexport const AreasTypeahead = ({isInvalid, feedback, filterBy, ...props}: {feedback?: string, onLoad?: (options:Area[])=>void} & Omit<TypeaheadProps<Area>, \"isLoading\" | \"options\" >) => {\r\n  const queryKey = \"areas.buscar\"\r\n\r\n  const buscar = useQuery(queryKey, ()=>{\r\n    return AreaService.obtener()\r\n  }, {\r\n    refetchOnMount: false,\r\n    refetchOnReconnect: false,\r\n    refetchOnWindowFocus: false\r\n  })\r\n\r\n  useEffect(()=>{\r\n    if(buscar.data){\r\n      props.onLoad && props.onLoad(buscar.data?.data)\r\n    }\r\n  }, [buscar.data, props.onLoad])\r\n\r\n  const options = useMemo(()=>{\r\n    if(Array.isArray(buscar.data?.data)){\r\n        return buscar.data?.data!\r\n    }\r\n    else if(buscar.data?.data){\r\n        console.error(buscar.data?.data)\r\n    }\r\n    return []\r\n  }, [buscar.data?.data])\r\n\r\n  return <InputGroup hasValidation>\r\n    <Typeahead\r\n      clearButton\r\n      emptyLabel=\"No se encontraron resultados\"\r\n      align=\"left\"\r\n      {...props}\r\n      className={(buscar.isError || isInvalid) ? \"is-invalid\" : \"\"}\r\n      isInvalid={buscar.isError || isInvalid}\r\n      filterBy={(regional, props)=>{\r\n        return (!props.text || isMatch(regional.nombre, props)) \r\n          && (!filterBy || (typeof filterBy === \"function\" && filterBy(regional, props)))\r\n      }}\r\n      isLoading={buscar.isFetching}\r\n      //@ts-ignore\r\n      options={options}\r\n      labelKey=\"nombre\"\r\n    />\r\n    {buscar.isError ? <>\r\n      <InputGroup.Append>\r\n        <Button variant=\"outline-danger\" onClick={()=>buscar.refetch()}><FaSync /></Button>\r\n      </InputGroup.Append>\r\n      <Form.Control.Feedback type=\"invalid\">{buscar.error?.response?.message || buscar.error?.message}</Form.Control.Feedback>\r\n    </>\r\n    : null}\r\n    {feedback ? <Form.Control.Feedback type=\"invalid\">{feedback}</Form.Control.Feedback> : null}\r\n  </InputGroup>\r\n}","import { Button, Col, Form, Spinner, Table } from 'react-bootstrap'\r\nimport { FaTrash } from 'react-icons/fa'\r\nimport { useHistory } from 'react-router-dom'\r\nimport { Controller, useForm, useFieldArray } from 'react-hook-form'\r\nimport { useMutation, useQueryClient } from 'react-query'\r\nimport { yupResolver } from '@hookform/resolvers/yup'\r\nimport moment from 'moment'\r\nimport * as yup from 'yup'\r\nimport { Regional, RegionalesTypeahead } from \"../../../../commons/components\"\r\nimport { PlanService } from '../services'\r\nimport { Area, AreasTypeahead } from './AreasTypeahead'\r\n\r\ntype Inputs = {\r\n  regional: Regional[]\r\n  area: Area[]\r\n  objetivoGeneral: string\r\n  actividades: {\r\n    nombre: string\r\n    inicio: Date\r\n    fin: Date\r\n    indicadores: string\r\n  }[]\r\n}\r\n\r\nconst schema = yup.object().shape({\r\n  regional: yup.array().length(1, \"Debe indicar una regional\"),\r\n  area: yup.array().length(1, \"Debe indicar un area\"),\r\n  objetivoGeneral: yup.string().label(\"objetivo general\").required(),\r\n  actividades: yup.array().min(1, \"Debe indicar al menos una actividad\").of(yup.object().shape({\r\n    nombre: yup.string().required().max(150).test(\"unique\", \"El nombre debe ser único\", function (value, context) {\r\n      //@ts-ignore\r\n      const count = context.from[1].value.actividades.filter((a:any)=>a.nombre === value).length\r\n      return count === 1\r\n    }),\r\n    indicadores: yup.string().required().max(250),\r\n    inicio: yup.date().emptyStringTo().typeError(\"No es una fecha valida\").required(),\r\n    fin: yup.date().emptyStringTo().typeError(\"No es una fecha valida\").required().when('inicio', (inicio: any)=>{\r\n      return inicio && yup.date().min(moment(inicio).add(1, 'days').toDate(), \"La fecha de fin debe ser mayor a la fecha de inicio\")\r\n    })\r\n  }))\r\n})\r\n\r\nexport const PlanForm = () => {\r\n  const history = useHistory<any>()\r\n  const {\r\n    control,\r\n    handleSubmit,\r\n    register,\r\n    formState,\r\n    watch\r\n  } = useForm<Inputs>({\r\n    mode: 'onBlur',\r\n    resolver: yupResolver(schema),\r\n    defaultValues: {\r\n      regional: [],\r\n      area: [],\r\n      actividades: []\r\n    }\r\n  })\r\n\r\n  const formErrors = formState.errors\r\n\r\n  const {\r\n    fields: actividadesField,\r\n    append: appendActividad,\r\n    remove: removeActividad\r\n  } = useFieldArray({\r\n    control,\r\n    name: 'actividades'\r\n  })\r\n\r\n  const queryClient = useQueryClient()\r\n\r\n  const guardar = useMutation((inputs: Inputs) => {\r\n    return PlanService.registrar({\r\n      regionalId: inputs.regional![0].id,\r\n      areaId: inputs.area![0].id,\r\n      objetivoGeneral: inputs.objetivoGeneral,\r\n      actividades:inputs.actividades.map(actividad => {\r\n        return {\r\n          ...actividad,\r\n          inicio: (actividad.inicio as any)!.toISOString().split(\"T\")[0],\r\n          fin: (actividad.fin as any)!.toISOString().split(\"T\")[0],\r\n        }\r\n      })\r\n    })\r\n  }, {\r\n    onSuccess: ({data}) => {\r\n      queryClient.invalidateQueries(\"planes.buscar\")\r\n      history.replace(`/seguimiento/planes/${data.id}`, {\r\n        plan: data\r\n      })\r\n    }\r\n  })\r\n\r\n  return <Form onSubmit={handleSubmit((inputs)=>{\r\n    guardar.mutate(inputs)\r\n  })}>\r\n    <h1 style={{fontSize: '1.75rem'}}>Plan</h1>\r\n    <Form.Row>\r\n      <Form.Group as={Col} sm={4}>\r\n        <Form.Label>Regional</Form.Label>\r\n        <Controller\r\n          control={control}\r\n          name=\"regional\"\r\n          render={({field, fieldState})=>{\r\n            return <RegionalesTypeahead\r\n              id=\"plan-form/regionales\"\r\n              isInvalid={!!fieldState.error}\r\n              feedback={fieldState.error?.message}\r\n              selected={field.value}\r\n              onBlur={field.onBlur}\r\n              onChange={field.onChange}\r\n            />\r\n          }}\r\n        />\r\n      </Form.Group>\r\n      <Form.Group as={Col} sm={4}>\r\n        <Form.Label>Area</Form.Label>\r\n        <Controller\r\n          control={control}\r\n          name=\"area\"\r\n          render={({field, fieldState})=>{\r\n            return <AreasTypeahead\r\n              id=\"plan-form/regionales\"\r\n              isInvalid={!!fieldState.error}\r\n              feedback={fieldState.error?.message}\r\n              selected={field.value}\r\n              onBlur={field.onBlur}\r\n              onChange={field.onChange}\r\n            />\r\n          }}\r\n        />\r\n      </Form.Group>\r\n    </Form.Row>\r\n    <Form.Group>\r\n      <Form.Label>Objetivo general</Form.Label>\r\n      <Form.Control\r\n        isInvalid={!!formErrors.objetivoGeneral}\r\n        {...register(\"objetivoGeneral\")} />\r\n      <Form.Control.Feedback type=\"invalid\">{formErrors.objetivoGeneral?.message}</Form.Control.Feedback>\r\n    </Form.Group>\r\n    <h2 style={{fontSize: '1.5rem'}}>Actividades</h2>\r\n    <div className=\"d-flex mb-2\">\r\n      <Button className=\"ml-auto\" onClick={()=>appendActividad({})}>Agregar</Button>\r\n    </div>\r\n    <Table responsive>\r\n      <thead>\r\n        <tr>\r\n          <th style={{width: 1}}>#</th>\r\n          <th style={{minWidth: \"15rem\"}}>Nombre</th>\r\n          <th style={{minWidth: \"20rem\"}}>Indicadores</th>\r\n          <th style={{minWidth: \"5rem\"}}>Inicio</th>\r\n          <th style={{minWidth: \"5rem\"}}>Fin</th>\r\n          <th style={{width: 1}}></th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        {\r\n          actividadesField.map((actividadField, index) => {\r\n            return <tr key={actividadField.id}>\r\n              <th scope=\"row\">{index+1}</th>\r\n              <td>\r\n                <Form.Group>\r\n                  <Form.Control \r\n                    isInvalid={!!(formErrors.actividades && formErrors.actividades[index]?.nombre)}\r\n                    {...register(`actividades.${index}.nombre` as const)} />\r\n                  <Form.Control.Feedback type=\"invalid\">{(formErrors.actividades && formErrors.actividades[index]?.nombre)?.message}</Form.Control.Feedback>\r\n                </Form.Group>\r\n              </td>\r\n              <td>\r\n                <Form.Group>\r\n                  <Form.Control as=\"textarea\"\r\n                    isInvalid={!!(formErrors.actividades && formErrors.actividades[index]?.indicadores)}\r\n                    {...register(`actividades.${index}.indicadores` as const)}/>\r\n                  <Form.Control.Feedback type=\"invalid\">{(formErrors.actividades && formErrors.actividades[index]?.indicadores)?.message}</Form.Control.Feedback>\r\n                </Form.Group>\r\n              </td>\r\n              <td>\r\n                <Form.Group>\r\n                  <Form.Control type=\"date\" \r\n                    isInvalid={!!(formErrors.actividades && formErrors.actividades[index]?.inicio)}\r\n                    {...register(`actividades.${index}.inicio` as const)}/>\r\n                  <Form.Control.Feedback type=\"invalid\">{(formErrors.actividades && formErrors.actividades[index]?.inicio)?.message}</Form.Control.Feedback>\r\n                </Form.Group>\r\n              </td>\r\n              <td>\r\n                <Form.Group>\r\n                  <Form.Control type=\"date\" \r\n                    isInvalid={!!(formErrors.actividades && formErrors.actividades[index])?.fin}\r\n                    {...register(`actividades.${index}.fin` as const)}/>\r\n                  <Form.Control.Feedback type=\"invalid\">{(formErrors.actividades && formErrors.actividades[index]?.fin)?.message}</Form.Control.Feedback>\r\n                </Form.Group>\r\n              </td>\r\n              <td>\r\n                <Button variant=\"danger\" onClick={()=>removeActividad(index)}><FaTrash /></Button>\r\n              </td>\r\n            </tr>\r\n          })\r\n        }\r\n      </tbody>\r\n    </Table>\r\n    <Form.Row>\r\n        <Col>\r\n          <Button type=\"submit\">\r\n            {guardar.isLoading ? <Spinner animation=\"border\" className=\"mr-2\" size=\"sm\" /> : null}\r\n            <span className=\"align-middle\">Guardar</span>\r\n          </Button>\r\n        </Col>\r\n      </Form.Row>\r\n  </Form>\r\n}","import { useEffect } from \"react\"\r\nimport { Dropdown } from \"react-bootstrap\"\r\nimport { useMutation, useQuery, useQueryClient, QueryKey } from \"react-query\"\r\nimport { FaEye, FaChartLine } from 'react-icons/fa'\r\nimport { Link, useParams, useLocation } from \"react-router-dom\"\r\nimport { VerticalEllipsisDropdownToggle } from \"../../../../commons/components\"\r\nimport { useModal } from \"../../../../commons/reusable-modal\"\r\nimport { ProtectedContent } from \"../../../../commons/auth/components\"\r\nimport { Actividad, PlanService } from \"../services\"\r\n// import { RolPolicy } from \"../policies\"\r\n\r\ntype Props = {\r\n  actividad: Actividad\r\n}\r\nexport const ActividadRowOptions = ({actividad}: Props) => {\r\n  const location = useLocation()\r\n  const {planId} = useParams<{\r\n    planId: string\r\n  }>()\r\n\r\n  return <Dropdown style={{position: \"initial\"}}>\r\n    <Dropdown.Toggle as={VerticalEllipsisDropdownToggle}\r\n      variant=\"link\" id={`dropdown-actividades-${actividad.id}`}\r\n    />\r\n    <Dropdown.Menu>\r\n      <ProtectedContent\r\n        authorize={()=>true}\r\n      >\r\n        <Dropdown.Item as={Link} to={{\r\n          pathname: `/seguimiento/planes/${planId}/actividades/${actividad.id}`,\r\n          state: {\r\n            actividad\r\n          }\r\n        }} ><FaEye className=\"mr-2\" />Detalles</Dropdown.Item>\r\n      </ProtectedContent>\r\n    </Dropdown.Menu>\r\n  </Dropdown>\r\n}","import React, {useEffect, useState} from 'react'\r\nimport { Button, Card, Col, Form, Table } from 'react-bootstrap'\r\nimport Skeleton from 'react-loading-skeleton'\r\nimport { useLocation, useParams } from 'react-router'\r\nimport { Link } from 'react-router-dom'\r\nimport moment from 'moment'\r\nimport { PlanService, Plan } from '../services'\r\nimport { useCargarPlan } from '../queries'\r\nimport { ActividadRowOptions } from './ActividadRowOptions'\r\n\r\nexport const PlanView = ()=>{\r\n  const { planId: id } = useParams<{\r\n    planId: string\r\n  }>()\r\n\r\n  const cargar = useCargarPlan(parseInt(id))\r\n\r\n  const plan = cargar.data\r\n  console.log(cargar, plan)\r\n\r\n  return <>\r\n    <h1 style={{fontSize: \"1.75rem\"}}>Plan</h1>\r\n    <Card className=\"mb-2\">\r\n      <Card.Header>Información</Card.Header>\r\n      <Card.Body>\r\n        <dl className=\"form-row\">\r\n          <dt className=\"col-sm-3\">Objetivo general</dt>\r\n          <dd className=\"col-sm-9\">{cargar.isFetching ? <Skeleton /> : plan?.objetivoGeneral }</dd>\r\n          <dt className=\"col-sm-3\">Avance</dt>\r\n          <dd className=\"col-sm-9\">{cargar.isFetching ? <Skeleton /> : `${plan?.avance}/${plan?.actividades.length}`}</dd>\r\n          <dt className=\"col-sm-3\">Avance esperado</dt>\r\n          <dd className=\"col-sm-9\">{cargar.isFetching ? <Skeleton /> : `${plan?.avanceEsperado}/${plan?.actividades.length}`}</dd>\r\n        </dl>\r\n      </Card.Body>\r\n    </Card>\r\n    <Card className=\"mb-2\">\r\n      <Card.Header>Actividades</Card.Header>\r\n      <Card.Body>\r\n        <Table responsive>\r\n          <thead>\r\n            <tr>\r\n              <th>#</th>\r\n              <th>Nombre</th>\r\n              <th>Indicadores</th>\r\n              <th>Inicio</th>\r\n              <th>Fin</th>\r\n              <th>Estado</th>\r\n              <th>Avance</th>\r\n              <th style={{width: 1}}></th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {plan?.actividades.map((actividad, index) => {\r\n              return <tr key={actividad.id}>\r\n                <th scope=\"row\">{index + 1}</th>\r\n                <td>{actividad.nombre}</td>\r\n                <td>{actividad.indicadores}</td>\r\n                <td className=\"text-nowrap\">{actividad.inicio}</td>\r\n                <td className=\"text-nowrap\">{actividad.fin}</td>\r\n                <td>{actividad.estado == 1 ? 'Pendiente' : actividad.estado == 2 ? 'En progreso' : actividad.estado == 3 ? 'En espera' : actividad.estado == 4 ? 'Concluido' : ''}</td>\r\n                <td >\r\n                  <div className=\"text-center\">\r\n                    <div>\r\n                      {`${actividad.avance}%/${actividad.avanceEsperado}%`}\r\n                    </div>\r\n                    <div className={actividad.avance >= actividad.avanceEsperado ? \"bg-success\" : moment().isBefore(moment(actividad.fin)) ? \"bg-warning\" : \"bg-danger\"}\r\n                      style={{width: `${actividad.avance}%`, overflow: 'hidden', position: 'relative', top: '-1.5rem'}}>\r\n                      <div className=\"text-white\" style={{width: 110}}>\r\n                        {`${actividad.avance}%/${actividad.avanceEsperado}%`}\r\n                      </div>\r\n                    </div>\r\n                  </div>              \r\n                </td>\r\n                <td><ActividadRowOptions actividad={actividad}/></td>\r\n              </tr>\r\n            })}\r\n          </tbody>\r\n        </Table>\r\n      </Card.Body>\r\n    </Card>\r\n  </>\r\n}","import { Button, Col, Form, InputGroup, Modal, ModalProps, Spinner } from 'react-bootstrap'\r\nimport { useForm } from 'react-hook-form'\r\nimport { useHistory, useParams } from 'react-router-dom'\r\nimport { yupResolver } from '@hookform/resolvers/yup'\r\nimport * as yup from 'yup'\r\nimport moment from 'moment'\r\nimport { useRegistrarAvance } from '../queries'\r\nimport { Actividad, PlanService } from '../services'\r\n\r\ntype Inputs = {\r\n  avance: number\r\n  informe: FileList\r\n  observaciones: string\r\n}\r\n\r\nconst schema = yup.object().shape({\r\n  avance: yup.number().emptyStringTo().required().min(0).max(100),\r\n  informe: yup.mixed(),\r\n  observaciones: yup.string().emptyStringTo(null).nullable().notRequired().max(250)\r\n})\r\n\r\ntype Props = {\r\n  actividad: Actividad\r\n} & ModalProps\r\n\r\n\r\nexport const AvanceForm = ({actividad, ...modalProps}: Props ) => {\r\n\r\n  const params = useParams<any>()\r\n  const planId = parseInt(params.planId)\r\n\r\n  const {\r\n    formState,\r\n    handleSubmit,\r\n    register,\r\n    reset\r\n  } = useForm<Inputs>({\r\n    resolver: yupResolver(schema)\r\n  })\r\n\r\n  const formErrors = formState.errors\r\n\r\n  const guardar = useRegistrarAvance({\r\n    onSuccess: () => {\r\n      reset()\r\n      modalProps.onHide && modalProps.onHide()\r\n    }\r\n  })\r\n  \r\n  return <Modal centered {...modalProps} >\r\n    <Modal.Header>Registro de avance</Modal.Header>\r\n    <Modal.Body>\r\n      <Form id=\"avance-form\" onSubmit={handleSubmit((values)=>{\r\n        guardar.mutate({\r\n          params: {\r\n            planId,\r\n            actividadId: actividad.id\r\n          },\r\n          data: {\r\n            avance: values.avance,\r\n            observaciones: values.observaciones,\r\n            informe: values.informe[0]\r\n          }\r\n        })\r\n      })}>\r\n        <Form.Row>\r\n          <Form.Group as={Col} sm={6}>\r\n            <Form.Label>Fecha</Form.Label>\r\n            <Form.Control disabled value={moment().format('L')} />\r\n          </Form.Group>\r\n          <Form.Group as={Col} sm={3}>\r\n            <Form.Label>Avance esperado</Form.Label>\r\n            <InputGroup hasValidation>\r\n              <Form.Control\r\n                disabled\r\n                value={actividad.avanceEsperado} />\r\n              <InputGroup.Append><InputGroup.Text>%</InputGroup.Text></InputGroup.Append>\r\n              <Form.Control.Feedback type=\"invalid\">{formErrors.avance?.message}</Form.Control.Feedback>\r\n            </InputGroup>\r\n          </Form.Group>\r\n          <Form.Group as={Col} sm={3}>\r\n            <Form.Label>Avance</Form.Label>\r\n            <InputGroup hasValidation>\r\n              <Form.Control\r\n                isInvalid={!!formErrors.avance}\r\n                {...register('avance')} />\r\n              <InputGroup.Append><InputGroup.Text>%</InputGroup.Text></InputGroup.Append>\r\n              <Form.Control.Feedback type=\"invalid\">{formErrors.avance?.message}</Form.Control.Feedback>\r\n            </InputGroup>\r\n          </Form.Group>\r\n        </Form.Row>\r\n        <Form.Group>\r\n          <Form.File\r\n            label='Informe'\r\n            {...register('informe')} \r\n          />\r\n        </Form.Group>\r\n        <Form.Group>\r\n          <Form.Label>Observaciones</Form.Label>\r\n          <Form.Control as=\"textarea\" {...register('observaciones')} />\r\n        </Form.Group>\r\n      </Form>\r\n    </Modal.Body>\r\n    <Modal.Footer>\r\n      <Button type=\"submit\" form=\"avance-form\">\r\n        {guardar.isLoading ? <Spinner animation=\"border\" className=\"mr-2\" size=\"sm\" /> : null}\r\n        <span className=\"align-middle\">Guardar</span>\r\n      </Button>\r\n    </Modal.Footer>\r\n  </Modal>\r\n}","import { Dropdown } from \"react-bootstrap\"\r\nimport { VscFilePdf } from 'react-icons/vsc'\r\nimport { useParams } from \"react-router-dom\"\r\nimport { VerticalEllipsisDropdownToggle } from \"../../../../commons/components\"\r\nimport { useModal } from '../../../../commons/reusable-modal'\r\nimport { ProtectedContent } from \"../../../../commons/auth/components\"\r\nimport { Avance } from \"../services\"\r\n\r\ntype Props = {\r\n  avance: Avance\r\n}\r\nexport const HistorialRowOptions = ({avance}: Props) => {\r\n  const params = useParams<{\r\n    planId: string\r\n    actividadId: string\r\n  }>()\r\n  const planId = parseInt(params.planId)\r\n  const actividadId = parseInt(params.actividadId)\r\n\r\n  const pdfModal = useModal(\"pdfModal\")\r\n\r\n  return <Dropdown style={{position: \"initial\"}}>\r\n    <Dropdown.Toggle as={VerticalEllipsisDropdownToggle}\r\n      variant=\"link\" id={`dropdown-historial-${avance.id}`}\r\n    />\r\n    <Dropdown.Menu>\r\n      <ProtectedContent\r\n        authorize={()=>true}\r\n      >\r\n        {/* <Dropdown.Item href={avance.informeUrl} download target=\"_self\"><FaDownload className=\"mr-2\" />Descargar informe</Dropdown.Item> */}\r\n        <Dropdown.Item onClick={()=>{\r\n          pdfModal.open({\r\n            title: 'Informe',\r\n            url: avance.informeUrl\r\n          })\r\n        }}><VscFilePdf className=\"mr-2\" />Ver informe</Dropdown.Item>\r\n      </ProtectedContent>\r\n    </Dropdown.Menu>\r\n  </Dropdown>\r\n}","import React, { useEffect, useMemo, useState, ComponentProps } from 'react'\r\nimport { Button, Card, Col, Form, Row, Table } from 'react-bootstrap'\r\nimport Skeleton from 'react-loading-skeleton'\r\nimport { FaPlus } from 'react-icons/fa'\r\nimport { useHistory, useParams } from 'react-router'\r\nimport { Link } from 'react-router-dom'\r\nimport { useQuery } from 'react-query'\r\nimport moment from 'moment'\r\nimport 'moment/locale/es'\r\nimport { Line } from 'react-chartjs-2';\r\nimport { useModal } from '../../../../commons/reusable-modal'\r\nimport { Actividad } from '../services'\r\nimport { useCargarActividad } from '../queries'\r\nimport { AvanceForm } from './AvanceForm'\r\nimport { HistorialRowOptions } from './HistorialRowOptions'\r\n\r\n\r\nconst options = {\r\n  scales: {\r\n    yAxes: [\r\n      {\r\n        ticks: {\r\n          beginAtZero: true\r\n        },\r\n        min: 0,\r\n        max: 100\r\n      },\r\n    ],\r\n  },\r\n};\r\n\r\nconst LineChart = React.memo((props: ComponentProps<typeof Line>)=><Line {...props}/>)\r\n\r\nexport const ActividadView = ()=>{\r\n  const history = useHistory<{actividad: Actividad}>()\r\n  const params = useParams<{\r\n    planId: string\r\n    actividadId: string\r\n  }>()\r\n  const planId = parseInt(params.planId)\r\n  const actividadId = parseInt(params.actividadId)\r\n\r\n  // const queryLoader = useModal('queryLoader')\r\n\r\n  const [avanceFormVisible, showAvanceForm] = useState(false)\r\n\r\n  const cargar = useCargarActividad(planId, actividadId)\r\n  const actividad = cargar.data\r\n\r\n  console.log(\"Actividad\", cargar)\r\n\r\n  const getLabels = () => {\r\n    const labels = [] as string[]\r\n    const first = actividad!.historial.length && moment(actividad!.historial[0].fecha)\r\n    const last = actividad!.historial.length && moment(actividad!.historial[actividad!.historial.length-1].fecha)\r\n    const inicio = moment(actividad!.inicio).subtract(1, 'days')\r\n    let fin = moment(actividad!.fin)\r\n    const hoy = moment()\r\n    fin = hoy.isAfter(fin) ? hoy : fin\r\n\r\n    const startDate = (!first || inicio.isBefore(first)) ? inicio :  first\r\n    const endDate = (!last || fin.isAfter(last)) ? fin : last\r\n\r\n    while(startDate.isSameOrBefore(endDate)){\r\n      labels.push(startDate.format('Do MMM'))\r\n      startDate.add(1, 'days')\r\n    }\r\n\r\n    return labels\r\n  }\r\n\r\n  const getData = () =>{\r\n    const data = [] as number[]\r\n    const first = actividad!.historial.length && moment(actividad!.historial[0].fecha)\r\n    const last = actividad!.historial.length && moment(actividad!.historial[actividad!.historial.length-1].fecha)\r\n    const inicio = moment(actividad!.inicio).subtract(1, 'days')\r\n    let fin = moment(actividad!.fin)\r\n    const hoy = moment()\r\n    fin = hoy.isBefore(fin) ? hoy : fin\r\n\r\n    const startDate = (!first || inicio.isBefore(first)) ? inicio :  first\r\n    let endDate = (!last || fin.isAfter(last)) ? fin : last\r\n\r\n    let ultimoAvance = 0\r\n    while(startDate.isSameOrBefore(endDate)){\r\n      const entries = actividad!.historial.filter(h=>h.fecha == startDate.format('YYYY-MM-DD'))\r\n      const avance = entries[entries.length-1]\r\n      ultimoAvance = avance ? avance.actual : ultimoAvance\r\n      data.push(ultimoAvance)\r\n      startDate.add(1, 'days')\r\n    }\r\n    return data\r\n  }\r\n\r\n  const getIdealData = () => {\r\n    const data = [] as number[]\r\n    const inicio = moment(actividad!.inicio).startOf('day').subtract(1, 'days')\r\n    const fin = moment(actividad!.fin)\r\n    const duration = moment.duration(fin.diff(inicio)).asDays()\r\n    const first = actividad!.historial.length && moment(actividad!.historial[0].fecha)\r\n    const last = actividad!.historial.length && moment(actividad!.historial[actividad!.historial.length-1].fecha)\r\n\r\n    const date = ((!first || inicio.isBefore(first)) ? inicio :  first).clone()\r\n    const endDate = ((!last || fin.isAfter(last)) ? fin : last).clone()\r\n\r\n    while(date.isSameOrBefore(endDate)){\r\n      const day = moment.duration(date.diff(inicio)).asDays()\r\n      data.push(Math.min(100, Math.max(0, Math.round(10000*day/duration)/100)))\r\n      date.add(1, 'days')\r\n    }\r\n\r\n    return data\r\n  }\r\n  \r\n  const data = useMemo(()=> {\r\n    if (!actividad) return\r\n    const labels = getLabels()\r\n\r\n    return {\r\n    labels: labels,\r\n    datasets: [\r\n        {\r\n          label: 'Avance real',\r\n          data: getData(),\r\n          fill: false,\r\n          backgroundColor: 'rgb(255, 99, 132)',\r\n          borderColor: 'rgba(255, 99, 132, 0.2)',\r\n        },\r\n        {\r\n          label: 'Avance Esperado',\r\n          data: getIdealData(),\r\n          borderDash: [5, 5],\r\n          fill: false,\r\n          backgroundColor: 'rgb(53, 54, 95)',\r\n          borderColor: 'rgba(53, 54, 95, 0.2)',\r\n        }\r\n      ],\r\n    }\r\n  }, [actividad]);\r\n\r\n  return <>\r\n    <h1 style={{fontSize: \"1.5rem\"}}>Actividad</h1>\r\n    <Row>\r\n      <Col className='mb-3'>\r\n        <Card style={{height: '100%'}}>\r\n          <Card.Header>Información</Card.Header>\r\n          <Card.Body>\r\n            <dl className=\"form-row\">\r\n              <dt className=\"col-sm-3\">Nombre</dt>\r\n              <dd className=\"col-sm-9\">{cargar.isFetching ? <Skeleton /> : actividad?.nombre}</dd>\r\n              \r\n              <dt className=\"col-sm-3\">Fecha de inicio</dt>\r\n              <dd className=\"col-sm-9\">{cargar.isFetching ? <Skeleton /> : `${moment(actividad?.inicio).format('L')}`}</dd>\r\n\r\n              <dt className=\"col-sm-3\">Fecha de conclusión</dt>\r\n              <dd className=\"col-sm-9\">{`${moment(actividad?.fin).format('L')} (${moment(actividad?.fin).locale('es').fromNow()})`}</dd>\r\n\r\n              <dt className=\"col-sm-3\">Avanve</dt>\r\n              <dd className=\"col-sm-9\">{actividad?.avance}%</dd>\r\n\r\n              <dt className=\"col-sm-3\">Avance esperado</dt>\r\n              <dd className=\"col-sm-9\">{actividad?.avanceEsperado}%</dd>\r\n            </dl>\r\n          </Card.Body>\r\n        </Card>\r\n      </Col>\r\n      <Col className=\"mb-3\">\r\n        <Card style={{height: '100%'}}>\r\n          <Card.Header>Gráfico</Card.Header>\r\n          <Card.Body>\r\n            {data && <LineChart data={data} options={options} type=\"line\" />}\r\n          </Card.Body>\r\n        </Card>\r\n      </Col>\r\n    </Row>\r\n    <Card>\r\n      <Card.Header>Historial de avance</Card.Header>\r\n      <Card.Body>\r\n        <div className=\"d-flex mb-2\">\r\n          <Button className=\"ml-auto\" onClick={()=>{\r\n            showAvanceForm(true)\r\n          }}\r\n          ><FaPlus /></Button>\r\n        </div>\r\n        <Table>\r\n          <thead>\r\n            <tr>\r\n              <th>#</th>\r\n              <th>Fecha</th>\r\n              <th style={{width: 110}}>Avance</th>\r\n              <th>Observaciones</th>\r\n              <th style={{width: 1}}></th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {actividad?.historial.map((avance, index) => {\r\n              return <tr key={avance.id}>\r\n                <th scope=\"row\">{index + 1}</th>\r\n                <td className=\"text-nowrap\">{moment(avance.fecha).format(\"L\")}</td>\r\n                <td>\r\n                  <div className=\"text-center\">\r\n                    <div>\r\n                      {`${avance.actual}%/${avance.esperado}%`}\r\n                    </div>\r\n                    <div className={avance.actual >= avance.esperado ? \"bg-success\" : moment().isBefore(moment(actividad.fin)) ? \"bg-warning\" : \"bg-danger\"}\r\n                      style={{width: `${avance.actual}%`, overflow: 'hidden', position: 'relative', top: '-1.5rem'}}>\r\n                      <div className=\"text-white\" style={{width: 110}}>\r\n                        {`${avance.actual}%/${avance.esperado}%`}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </td>\r\n                <td>{avance.observaciones}</td>\r\n                <td><HistorialRowOptions avance={avance}/></td>\r\n              </tr>\r\n            })}\r\n          </tbody>\r\n        </Table>\r\n        <div className=\"d-flex mb-2\">\r\n          <Button className=\"ml-auto\" onClick={()=>{\r\n            showAvanceForm(true)\r\n          }}\r\n          ><FaPlus /></Button>\r\n        </div>\r\n        {actividad && <AvanceForm actividad={actividad} show={avanceFormVisible} onHide={()=>showAvanceForm(false)} />}\r\n      </Card.Body>\r\n    </Card>\r\n  </>\r\n}","import { useMemo } from 'react'\r\nimport { useRouteMatch, Switch, useLocation} from 'react-router-dom'\r\nimport { Image, Modal } from 'react-bootstrap'\r\nimport { FaTasks } from 'react-icons/fa'\r\nimport SidebarLayout from '../../commons/components/layouts/SidebarLayout'\r\nimport { ProtectedRoute } from '../../commons/auth/components'\r\nimport { useLoggedUser } from '../../commons/auth/hooks'\r\nimport { removeTrailingSlashes } from '../../commons/utils'\r\nimport { PlanIndex, PlanForm, PlanView, ActividadView, AvanceForm } from './planes'\r\n\r\nexport const SeguimientoApp = ()=>{\r\n  const match = useRouteMatch()\r\n  const url = removeTrailingSlashes(match.url)\r\n  const location = useLocation<any>()\r\n  const loggedUser = useLoggedUser()\r\n\r\n  const sidebarItems = useMemo(()=>{\r\n    const items = [] as any[]\r\n      items.push({\r\n        id: \"planes\",\r\n        icon: <FaTasks />,\r\n        path: `${url}/planes`,\r\n        title: \"Planes\",\r\n      })\r\n    return items\r\n  }, [loggedUser])\r\n\r\n  const background = location.state?.background || location\r\n\r\n  return <SidebarLayout \r\n    sidebar={{\r\n        header: <div className=\"d-flex justify-content-center\"><Image src=\"/logo-lg.png\" /></div>,\r\n        items: sidebarItems\r\n    }}\r\n  >\r\n    <Switch location={background}>\r\n      <ProtectedRoute exact path={`${url}/planes`}\r\n      >\r\n        <PlanIndex />\r\n      </ProtectedRoute>\r\n      <ProtectedRoute exact path={[`${url}/planes/registrar`]}\r\n      >\r\n        <PlanForm />\r\n      </ProtectedRoute>\r\n      <ProtectedRoute path={`${url}/planes/:planId/actividades/:actividadId`}\r\n      >\r\n        <ActividadView />\r\n      </ProtectedRoute>\r\n      <ProtectedRoute exact path={`${url}/planes/:planId`}\r\n      >\r\n        <PlanView />\r\n      </ProtectedRoute>\r\n    </Switch>\r\n    {/* <ProtectedRoute exact path={`${url}/planes/:planId/actividades/:actividadId/registrar-avance`}\r\n    >\r\n      <AvanceForm />\r\n    </ProtectedRoute>   \r\n    <ProtectedRoute exact path={`${url}/planes/:planId/actividades/:actividadId/grafico`}\r\n    >\r\n      <Modal show={true}>\r\n        Grafico\r\n      </Modal>\r\n    </ProtectedRoute>   */}\r\n  </SidebarLayout>\r\n}\r\n\r\nexport default SeguimientoApp"],"sourceRoot":""}