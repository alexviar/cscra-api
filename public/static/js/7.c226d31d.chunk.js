(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[7],{633:function(e,t,a){},634:function(e,t,a){"use strict";var c=a(16),n=a(1),i=a.n(n),r=a(635),s=a(46);function d(e,t){Object(n.useEffect)((function(){var a=function(a){var c=null===e||void 0===e?void 0:e.current;c&&!c.contains(a.target)&&document.querySelector("html")!=a.target&&t(a)};return document.addEventListener("mousedown",a),document.addEventListener("touchstart",a),function(){document.removeEventListener("mousedown",a),document.removeEventListener("touchstart",a)}}),[e,t])}var l=a(35),o=a(4),j=function(e){var t=e.children,a=e.onClickOutside,i=Object(l.a)(e,["children","onClickOutside"]),r=Object(n.useRef)(null);return d(r,a),Object(o.jsx)("div",Object(c.a)(Object(c.a)({ref:r},i),{},{children:t}))},b=a(650),h=a(24),u=a(88),O=function(e){var t=Object(h.j)(e.path||"");return Object(o.jsxs)(o.Fragment,{children:[e.path?Object(o.jsxs)(b.a.Item,{as:u.b,to:e.path,action:!0,active:!!t,className:"border-0 text-nowrap",style:{padding:".5rem 1rem"},children:[e.icon,Object(o.jsx)("span",{style:{verticalAlign:"middle",marginLeft:"0.5rem"},children:e.title})]},e.id):Object(o.jsxs)("div",{className:"list-group-item border-0 text-nowrap",style:{padding:".5rem 1rem"},children:[e.icon,Object(o.jsx)("span",{style:{verticalAlign:"middle",marginLeft:"0.5rem"},children:e.title})]},e.id),e.items&&e.items.map((function(e){return Object(o.jsxs)(u.b,{to:e.path,style:{padding:".5rem 1rem",paddingLeft:"2rem"},className:"list-group-item list-group-item-action border-0 text-nowrap",children:[e.icon||null,Object(o.jsx)("span",{style:{verticalAlign:"middle",marginLeft:"0.5rem"},children:e.title})]},e.id)}))]})},v=function(e){var t=e.className,a=void 0===t?"":t,n=e.side,i=void 0===n?"right":n,r=e.header,s=void 0===r?"":r,d=e.items,l=void 0===d?[]:d;e.renderItem;return Object(o.jsxs)("div",{className:"".concat(a,"  ").concat({left:"border-left",right:"border-right"}[i]),id:"sidebar-wrapper",children:[Object(o.jsx)("div",{className:"sidebar-heading mt-2",children:s}),Object(o.jsx)("hr",{className:"mx-2"}),Object(o.jsx)(b.a,{variant:"flush",children:l.map((function(e){return Object(o.jsx)(O,Object(c.a)({},e),e.id)}))})]})};a(633),t.a=function(e){var t=e.sidebar,a=e.children,n=Object(s.c)((function(e){return e.sidebarVisibility})),d=Object(s.b)(),l=i.a.useCallback((function(e){console.log(e.target);var t=document.querySelector('[aria-label="Toggle navigation"]');(null===t||void 0===t?void 0:t.contains(e.target))||d({type:"CLOSE_SIDEBAR"})}),[n]);return Object(o.jsxs)("div",{className:"position-relative d-flex flex-grow-1 bg-light"+(n?" toggled":""),id:"wrapper",children:[Object(o.jsx)(j,{onClickOutside:l,children:Object(o.jsx)(v,Object(c.a)({className:"bg-white shadow-sm"},t))}),Object(o.jsx)(r.a,{className:"d-flex flex-column flex-grow-1",children:Object(o.jsx)("div",{className:"d-flex flex-column bg-white rounded-lg shadow-sm m-2 p-3 flex-grow-1",children:a})})]})}},696:function(e,t,a){"use strict";a.r(t),a.d(t,"SeguimientoApp",(function(){return je}));var c,n=a(1),i=a.n(n),r=a(24),s=a(619),d=a(39),l=a(634),o=a(128),j=a(146),b=a(44),h=a(16),u=a(28),O=a(611),v=a(623),x=a(340),m=a(234),f=a(259),p=a(636),g=a(620),y=a(88),N=a(192),w=a(23),I=a(627),C=a(183),S=a(629),k=a(26),A=a(27),F=a(62),E=new(function(){function e(){Object(k.a)(this,e)}return Object(A.a)(e,[{key:"buscar",value:function(e,t){return F.apiClient.get("/planes",{params:Object(b.c)({page:t,filter:e})})}},{key:"cargar",value:function(e){return F.apiClient.get("/planes/".concat(e))}},{key:"registrar",value:function(e){return F.apiClient.post("/planes",Object(b.c)(e))}},{key:"cargarActividad",value:function(e,t){return F.apiClient.get("/planes/".concat(e,"/actividades/").concat(t))}},{key:"registrarAvance",value:function(e,t,a){var c=new FormData;return c.append("avance",String(a.avance)),c.append("observaciones",a.observaciones),c.append("informe",a.informe),F.apiClient.post("/planes/".concat(e,"/actividades/").concat(t,"/registrar-avance"),c,{headers:{"Content-Type":"multipart/form-data"}})}}]),e}()),L=a(91),B=function(){return L.b.get("areas")},G=function(e,t){var a,n=Object(C.b)(),i=["planes.cargar",e];if("idle"===(null===(a=n.getQueryState(i))||void 0===a?void 0:a.status)){var r,s=n.getQueryData(c),d=null===s||void 0===s||null===(r=s.data.records)||void 0===r?void 0:r.find((function(t){return t.id===e}));d&&n.setQueryData(i,{data:d})}return Object(I.a)(["planes.cargar",e],(function(){return E.cargar(e)}),Object(h.a)({refetchOnWindowFocus:!1,refetchOnReconnect:!1,select:function(e){return e.data}},t))},z=a(98),D=a(73),M=a(4),q=function(e){var t=e.plan;e.queryKey,Object(D.b)("queryLoader"),Object(C.b)();return Object(M.jsxs)(z.a,{style:{position:"initial"},children:[Object(M.jsx)(z.a.Toggle,{as:N.j,variant:"link",id:"dropdown-planes-".concat(t.id)}),Object(M.jsx)(z.a.Menu,{children:Object(M.jsx)(o.b,{authorize:function(){return!0},children:Object(M.jsxs)(z.a.Item,{as:y.b,to:{pathname:"/seguimiento/planes/".concat(t.id),state:{plan:t}},children:[Object(M.jsx)(d.e,{className:"mr-2"})," Detalles"]})})})]})},T=function(){var e,t,a,i=Object(j.a)(),r=Object(n.useState)({current:1,size:10}),s=Object(u.a)(r,2),l=s[0],b=s[1],w=Object(n.useMemo)((function(){return{}}),[i]),C=Object(n.useState)(w),S=Object(u.a)(C,2),k=S[0],A=(S[1],Object(n.useState)(!1)),F=Object(u.a)(A,2),L=F[0],B=F[1],G=function(e,t){return c=["planes.buscar",e,t],Object(I.a)(c,(function(){return E.buscar(e,t)}),{refetchOnWindowFocus:!1,refetchOnReconnect:!1})}(k,l),z=(null===(e=G.data)||void 0===e||null===(t=e.data)||void 0===t||null===(a=t.meta)||void 0===a?void 0:a.total)||0;return Object(M.jsxs)("div",{className:"px-1",children:[Object(M.jsx)("h2",{style:{fontSize:"1.75rem"},children:"Planes"}),Object(M.jsx)("div",{className:"d-flex my-2",children:Object(M.jsxs)(v.a.Row,{className:"ml-auto flex-nowrap",children:[Object(M.jsxs)(o.b,{authorize:function(){return!0},children:[Object(M.jsx)(x.a,{xs:"auto",children:Object(M.jsx)(m.a,{onClick:function(){G.refetch()},children:Object(M.jsx)(d.k,{})})}),Object(M.jsx)(x.a,{xs:"auto",children:Object(M.jsx)(m.a,{onClick:function(){B((function(e){return!e}))},children:Object(M.jsx)(d.f,{})})})]}),Object(M.jsx)(o.b,{authorize:function(){return!0},children:Object(M.jsx)(x.a,{xs:"auto",children:Object(M.jsx)(m.a,{as:y.b,to:"/seguimiento/planes/registrar",className:"d-flex align-items-center",children:"Nuevo"})})})]})}),Object(M.jsxs)(o.b,{authorize:function(){return!0},children:[Object(M.jsx)(f.a,{in:L,children:Object(M.jsx)("div",{})}),Object(M.jsx)("div",{className:"d-flex",children:Object(M.jsx)("div",{className:"ml-auto mb-2",children:Object(M.jsxs)("div",{className:"d-flex flex-row flex-nowrap align-items-center",children:[Object(M.jsx)("span",{children:"Mostrar"}),Object(M.jsxs)(v.a.Control,{className:"mx-2",as:"select",value:l.size,onChange:function(e){var t=e.target.value;b((function(e){return Object(h.a)(Object(h.a)({},e),{},{size:parseInt(t)})}))},children:[Object(M.jsx)("option",{value:10,children:"10"}),Object(M.jsx)("option",{value:20,children:"20"}),Object(M.jsx)("option",{value:30,children:"30"}),Object(M.jsx)("option",{value:50,children:"50"}),Object(M.jsx)("option",{value:100,children:"100"})]}),Object(M.jsx)("span",{children:"filas"})]})})}),Object(M.jsxs)(p.a,{responsive:!0,children:[Object(M.jsx)("thead",{children:Object(M.jsxs)("tr",{children:[Object(M.jsx)("th",{style:{width:1},children:"#"}),Object(M.jsx)("th",{children:"Objetivo general"}),Object(M.jsx)("th",{children:"Estado"}),Object(M.jsx)("th",{style:{width:1}})]})}),Object(M.jsx)("tbody",{children:function(){if(G.isFetching)return Object(M.jsx)("tr",{children:Object(M.jsxs)("td",{className:"bg-light text-center",colSpan:100,children:[Object(M.jsx)(O.a,{className:"mr-2",variant:"primary",animation:"border",size:"sm"}),"Cargando"]})});if(G.isError){var e,t,a=G.error;return Object(M.jsx)("tr",{children:Object(M.jsx)("td",{className:"bg-danger text-light text-center",colSpan:100,children:(null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message})})}if(G.data){var c=G.data.data.records;return 0==c.length?Object(M.jsx)("tr",{children:Object(M.jsx)("td",{className:"bg-light text-center",colSpan:100,children:"No se encontraron resultados"})}):c.map((function(e,t){return Object(M.jsxs)("tr",{children:[Object(M.jsx)("td",{children:t+1}),Object(M.jsx)("td",{children:e.objetivoGeneral}),Object(M.jsx)("td",{children:e.concluido?"S\xed":"No"}),Object(M.jsx)("td",{children:Object(M.jsx)(q,{plan:e,queryKey:["planes.buscar",k,l]})})]},e.id)}))}}()})]}),Object(M.jsxs)(g.a,{children:[Object(M.jsx)(x.a,{children:Object(M.jsx)("span",{className:"mr-auto",children:"Se encontraron ".concat(z," resultados")})}),Object(M.jsx)(x.a,{children:Object(M.jsx)(N.e,{current:l.current,total:Math.ceil((z-l.size)/l.size)+1,onChange:function(e){return b((function(t){return Object(h.a)(Object(h.a)({},t),{},{current:e})}))}})})]})]})]})},R=a(99),H=a(242),Q=a(243),W=a.n(Q),V=a(74),P=a(35),Y=a(617),K=a(90),J=(a(147),function(e){var t,a,c,i,r=e.isInvalid,s=e.feedback,l=e.filterBy,o=Object(P.a)(e,["isInvalid","feedback","filterBy"]),j=Object(I.a)("areas.buscar",(function(){return B()}),{refetchOnMount:!1,refetchOnReconnect:!1,refetchOnWindowFocus:!1});Object(n.useEffect)((function(){var e;j.data&&(o.onLoad&&o.onLoad(null===(e=j.data)||void 0===e?void 0:e.data))}),[j.data,o.onLoad]);var u=Object(n.useMemo)((function(){var e,t,a,c;return Array.isArray(null===(e=j.data)||void 0===e?void 0:e.data)?null===(a=j.data)||void 0===a?void 0:a.data:((null===(t=j.data)||void 0===t?void 0:t.data)&&console.error(null===(c=j.data)||void 0===c?void 0:c.data),[])}),[null===(t=j.data)||void 0===t?void 0:t.data]);return Object(M.jsxs)(Y.a,{hasValidation:!0,children:[Object(M.jsx)(K.a,Object(h.a)(Object(h.a)({clearButton:!0,emptyLabel:"No se encontraron resultados",align:"left"},o),{},{className:j.isError||r?"is-invalid":"",isInvalid:j.isError||r,filterBy:function(e,t){return(!t.text||Object(b.a)(e.nombre,t))&&(!l||"function"===typeof l&&l(e,t))},isLoading:j.isFetching,options:u,labelKey:"nombre"})),j.isError?Object(M.jsxs)(M.Fragment,{children:[Object(M.jsx)(Y.a.Append,{children:Object(M.jsx)(m.a,{variant:"outline-danger",onClick:function(){return j.refetch()},children:Object(M.jsx)(d.k,{})})}),Object(M.jsx)(v.a.Control.Feedback,{type:"invalid",children:(null===(a=j.error)||void 0===a||null===(c=a.response)||void 0===c?void 0:c.message)||(null===(i=j.error)||void 0===i?void 0:i.message)})]}):null,s?Object(M.jsx)(v.a.Control.Feedback,{type:"invalid",children:s}):null]})}),U=V.g().shape({regional:V.b().length(1,"Debe indicar una regional"),area:V.b().length(1,"Debe indicar un area"),objetivoGeneral:V.j().label("objetivo general").required(),actividades:V.b().min(1,"Debe indicar al menos una actividad").of(V.g().shape({nombre:V.j().required().max(150).test("unique","El nombre debe ser \xfanico",(function(e,t){return 1===t.from[1].value.actividades.filter((function(t){return t.nombre===e})).length})),indicadores:V.j().required().max(250),inicio:V.c().emptyStringTo().typeError("No es una fecha valida").required(),fin:V.c().emptyStringTo().typeError("No es una fecha valida").required().when("inicio",(function(e){return e&&V.c().min(W()(e).add(1,"days").toDate(),"La fecha de fin debe ser mayor a la fecha de inicio")}))}))}),Z=function(){var e,t=Object(r.g)(),a=Object(R.h)({mode:"onBlur",resolver:Object(H.a)(U),defaultValues:{regional:[],area:[],actividades:[]}}),c=a.control,n=a.handleSubmit,i=a.register,s=a.formState,l=(a.watch,s.errors),o=Object(R.g)({control:c,name:"actividades"}),j=o.fields,b=o.append,u=o.remove,f=Object(C.b)(),g=Object(S.a)((function(e){return E.registrar({regionalId:e.regional[0].id,areaId:e.area[0].id,objetivoGeneral:e.objetivoGeneral,actividades:e.actividades.map((function(e){return Object(h.a)(Object(h.a)({},e),{},{inicio:e.inicio.toISOString().split("T")[0],fin:e.fin.toISOString().split("T")[0]})}))})}),{onSuccess:function(e){var a=e.data;f.invalidateQueries("planes.buscar"),t.replace("/seguimiento/planes/".concat(a.id),{plan:a})}});return Object(M.jsxs)(v.a,{onSubmit:n((function(e){g.mutate(e)})),children:[Object(M.jsx)("h1",{style:{fontSize:"1.75rem"},children:"Plan"}),Object(M.jsxs)(v.a.Row,{children:[Object(M.jsxs)(v.a.Group,{as:x.a,sm:4,children:[Object(M.jsx)(v.a.Label,{children:"Regional"}),Object(M.jsx)(R.a,{control:c,name:"regional",render:function(e){var t,a=e.field,c=e.fieldState;return Object(M.jsx)(N.i,{id:"plan-form/regionales",isInvalid:!!c.error,feedback:null===(t=c.error)||void 0===t?void 0:t.message,selected:a.value,onBlur:a.onBlur,onChange:a.onChange})}})]}),Object(M.jsxs)(v.a.Group,{as:x.a,sm:4,children:[Object(M.jsx)(v.a.Label,{children:"Area"}),Object(M.jsx)(R.a,{control:c,name:"area",render:function(e){var t,a=e.field,c=e.fieldState;return Object(M.jsx)(J,{id:"plan-form/regionales",isInvalid:!!c.error,feedback:null===(t=c.error)||void 0===t?void 0:t.message,selected:a.value,onBlur:a.onBlur,onChange:a.onChange})}})]})]}),Object(M.jsxs)(v.a.Group,{children:[Object(M.jsx)(v.a.Label,{children:"Objetivo general"}),Object(M.jsx)(v.a.Control,Object(h.a)({isInvalid:!!l.objetivoGeneral},i("objetivoGeneral"))),Object(M.jsx)(v.a.Control.Feedback,{type:"invalid",children:null===(e=l.objetivoGeneral)||void 0===e?void 0:e.message})]}),Object(M.jsx)("h2",{style:{fontSize:"1.5rem"},children:"Actividades"}),Object(M.jsx)("div",{className:"d-flex mb-2",children:Object(M.jsx)(m.a,{className:"ml-auto",onClick:function(){return b({})},children:"Agregar"})}),Object(M.jsxs)(p.a,{responsive:!0,children:[Object(M.jsx)("thead",{children:Object(M.jsxs)("tr",{children:[Object(M.jsx)("th",{style:{width:1},children:"#"}),Object(M.jsx)("th",{style:{minWidth:"15rem"},children:"Nombre"}),Object(M.jsx)("th",{style:{minWidth:"20rem"},children:"Indicadores"}),Object(M.jsx)("th",{style:{minWidth:"5rem"},children:"Inicio"}),Object(M.jsx)("th",{style:{minWidth:"5rem"},children:"Fin"}),Object(M.jsx)("th",{style:{width:1}})]})}),Object(M.jsx)("tbody",{children:j.map((function(e,t){var a,c,n,r,s,o,j,b,O,x,f,p;return Object(M.jsxs)("tr",{children:[Object(M.jsx)("th",{scope:"row",children:t+1}),Object(M.jsx)("td",{children:Object(M.jsxs)(v.a.Group,{children:[Object(M.jsx)(v.a.Control,Object(h.a)({isInvalid:!(!l.actividades||!(null===(a=l.actividades[t])||void 0===a?void 0:a.nombre))},i("actividades.".concat(t,".nombre")))),Object(M.jsx)(v.a.Control.Feedback,{type:"invalid",children:null===(c=l.actividades&&(null===(n=l.actividades[t])||void 0===n?void 0:n.nombre))||void 0===c?void 0:c.message})]})}),Object(M.jsx)("td",{children:Object(M.jsxs)(v.a.Group,{children:[Object(M.jsx)(v.a.Control,Object(h.a)({as:"textarea",isInvalid:!(!l.actividades||!(null===(r=l.actividades[t])||void 0===r?void 0:r.indicadores))},i("actividades.".concat(t,".indicadores")))),Object(M.jsx)(v.a.Control.Feedback,{type:"invalid",children:null===(s=l.actividades&&(null===(o=l.actividades[t])||void 0===o?void 0:o.indicadores))||void 0===s?void 0:s.message})]})}),Object(M.jsx)("td",{children:Object(M.jsxs)(v.a.Group,{children:[Object(M.jsx)(v.a.Control,Object(h.a)({type:"date",isInvalid:!(!l.actividades||!(null===(j=l.actividades[t])||void 0===j?void 0:j.inicio))},i("actividades.".concat(t,".inicio")))),Object(M.jsx)(v.a.Control.Feedback,{type:"invalid",children:null===(b=l.actividades&&(null===(O=l.actividades[t])||void 0===O?void 0:O.inicio))||void 0===b?void 0:b.message})]})}),Object(M.jsx)("td",{children:Object(M.jsxs)(v.a.Group,{children:[Object(M.jsx)(v.a.Control,Object(h.a)({type:"date",isInvalid:!!(null===(x=l.actividades&&l.actividades[t])||void 0===x?void 0:x.fin)},i("actividades.".concat(t,".fin")))),Object(M.jsx)(v.a.Control.Feedback,{type:"invalid",children:null===(f=l.actividades&&(null===(p=l.actividades[t])||void 0===p?void 0:p.fin))||void 0===f?void 0:f.message})]})}),Object(M.jsx)("td",{children:Object(M.jsx)(m.a,{variant:"danger",onClick:function(){return u(t)},children:Object(M.jsx)(d.m,{})})})]},e.id)}))})]}),Object(M.jsx)(v.a.Row,{children:Object(M.jsx)(x.a,{children:Object(M.jsxs)(m.a,{type:"submit",children:[g.isLoading?Object(M.jsx)(O.a,{animation:"border",className:"mr-2",size:"sm"}):null,Object(M.jsx)("span",{className:"align-middle",children:"Guardar"})]})})})]})},_=a(651),X=a(640),$=a.n(X),ee=function(e){var t=e.actividad,a=(Object(r.h)(),Object(r.i)().planId);return Object(M.jsxs)(z.a,{style:{position:"initial"},children:[Object(M.jsx)(z.a.Toggle,{as:N.j,variant:"link",id:"dropdown-actividades-".concat(t.id)}),Object(M.jsx)(z.a.Menu,{children:Object(M.jsx)(o.b,{authorize:function(){return!0},children:Object(M.jsxs)(z.a.Item,{as:y.b,to:{pathname:"/seguimiento/planes/".concat(a,"/actividades/").concat(t.id),state:{actividad:t}},children:[Object(M.jsx)(d.e,{className:"mr-2"}),"Detalles"]})})})]})},te=function(){var e=Object(r.i)().planId,t=G(parseInt(e)),a=t.data;return console.log(t,a),Object(M.jsxs)(M.Fragment,{children:[Object(M.jsx)("h1",{style:{fontSize:"1.75rem"},children:"Plan"}),Object(M.jsxs)(_.a,{className:"mb-2",children:[Object(M.jsx)(_.a.Header,{children:"Informaci\xf3n"}),Object(M.jsx)(_.a.Body,{children:Object(M.jsxs)("dl",{className:"form-row",children:[Object(M.jsx)("dt",{className:"col-sm-3",children:"Objetivo general"}),Object(M.jsx)("dd",{className:"col-sm-9",children:t.isFetching?Object(M.jsx)($.a,{}):null===a||void 0===a?void 0:a.objetivoGeneral}),Object(M.jsx)("dt",{className:"col-sm-3",children:"Avance"}),Object(M.jsx)("dd",{className:"col-sm-9",children:t.isFetching?Object(M.jsx)($.a,{}):"".concat(null===a||void 0===a?void 0:a.avance,"/").concat(null===a||void 0===a?void 0:a.actividades.length)}),Object(M.jsx)("dt",{className:"col-sm-3",children:"Avance esperado"}),Object(M.jsx)("dd",{className:"col-sm-9",children:t.isFetching?Object(M.jsx)($.a,{}):"".concat(null===a||void 0===a?void 0:a.avanceEsperado,"/").concat(null===a||void 0===a?void 0:a.actividades.length)})]})})]}),Object(M.jsxs)(_.a,{className:"mb-2",children:[Object(M.jsx)(_.a.Header,{children:"Actividades"}),Object(M.jsx)(_.a.Body,{children:Object(M.jsxs)(p.a,{responsive:!0,children:[Object(M.jsx)("thead",{children:Object(M.jsxs)("tr",{children:[Object(M.jsx)("th",{children:"#"}),Object(M.jsx)("th",{children:"Nombre"}),Object(M.jsx)("th",{children:"Indicadores"}),Object(M.jsx)("th",{children:"Inicio"}),Object(M.jsx)("th",{children:"Fin"}),Object(M.jsx)("th",{children:"Estado"}),Object(M.jsx)("th",{children:"Avance"}),Object(M.jsx)("th",{style:{width:1}})]})}),Object(M.jsx)("tbody",{children:null===a||void 0===a?void 0:a.actividades.map((function(e,t){return Object(M.jsxs)("tr",{children:[Object(M.jsx)("th",{scope:"row",children:t+1}),Object(M.jsx)("td",{children:e.nombre}),Object(M.jsx)("td",{children:e.indicadores}),Object(M.jsx)("td",{className:"text-nowrap",children:e.inicio}),Object(M.jsx)("td",{className:"text-nowrap",children:e.fin}),Object(M.jsx)("td",{children:1==e.estado?"Pendiente":2==e.estado?"En progreso":3==e.estado?"En espera":4==e.estado?"Concluido":""}),Object(M.jsx)("td",{children:Object(M.jsxs)("div",{className:"text-center",children:[Object(M.jsx)("div",{children:"".concat(e.avance,"%/").concat(e.avanceEsperado,"%")}),Object(M.jsx)("div",{className:e.avance>=e.avanceEsperado?"bg-success":W()().isBefore(W()(e.fin))?"bg-warning":"bg-danger",style:{width:"".concat(e.avance,"%"),overflow:"hidden",position:"relative",top:"-1.5rem"},children:Object(M.jsx)("div",{className:"text-white",style:{width:110},children:"".concat(e.avance,"%/").concat(e.avanceEsperado,"%")})})]})}),Object(M.jsx)("td",{children:Object(M.jsx)(ee,{actividad:e})})]},e.id)}))})]})})]})]})},ae=(a(656),a(691)),ce=a(622),ne=V.g().shape({avance:V.f().emptyStringTo().required().min(0).max(100),informe:V.e(),observaciones:V.j().emptyStringTo(null).nullable().notRequired().max(250)}),ie=function(e){var t,a,n=e.actividad,i=Object(P.a)(e,["actividad"]),s=Object(r.i)(),d=parseInt(s.planId),l=Object(R.h)({resolver:Object(H.a)(ne)}),o=l.formState,j=l.handleSubmit,b=l.register,u=l.reset,f=o.errors,p=function(e){var t=Object(C.b)();return Object(S.a)((function(e){var t=e.params,a=t.planId,c=t.actividadId,n=e.data;return E.registrarAvance(a,c,n)}),Object(h.a)(Object(h.a)({},e),{},{onSuccess:function(a,n,i){var r=a.data,s=n.params,d=s.planId,l=s.actividadId;(null===e||void 0===e?void 0:e.onSuccess)&&e.onSuccess(a,n,i);var o=function(e,t){var a=e.actividades.map((function(e){return e.id===l?Object(h.a)(Object(h.a)({},e),{},{avance:t.actual,avanceEsperado:t.esperado,historial:[].concat(Object(w.a)(e.historial),[t])}):e}));return Object(h.a)(Object(h.a)({},j.data),{},{avance:a.filter((function(e){return 100==e.avance})).length,avanceEsperado:a.filter((function(e){return 100==e.avanceEsperado})).length,actividades:a})},j=t.getQueryData(["planes.cargar",d]);j?t.setQueryData(["planes.cargar",d],Object(h.a)(Object(h.a)({},j),{},{data:o(j.data,r)})):t.setQueryData(c,(function(e){var t=e.data.records.map((function(e){return e.id===d?o(e,r):e}));return Object(h.a)(Object(h.a)({},e),{},{data:Object(h.a)(Object(h.a)({},e.data),{},{records:t})})}))}}))}({onSuccess:function(){u(),i.onHide&&i.onHide()}});return Object(M.jsxs)(ce.a,Object(h.a)(Object(h.a)({centered:!0},i),{},{children:[Object(M.jsx)(ce.a.Header,{children:"Registro de avance"}),Object(M.jsx)(ce.a.Body,{children:Object(M.jsxs)(v.a,{id:"avance-form",onSubmit:j((function(e){p.mutate({params:{planId:d,actividadId:n.id},data:{avance:e.avance,observaciones:e.observaciones,informe:e.informe[0]}})})),children:[Object(M.jsxs)(v.a.Row,{children:[Object(M.jsxs)(v.a.Group,{as:x.a,sm:6,children:[Object(M.jsx)(v.a.Label,{children:"Fecha"}),Object(M.jsx)(v.a.Control,{disabled:!0,value:W()().format("L")})]}),Object(M.jsxs)(v.a.Group,{as:x.a,sm:3,children:[Object(M.jsx)(v.a.Label,{children:"Avance esperado"}),Object(M.jsxs)(Y.a,{hasValidation:!0,children:[Object(M.jsx)(v.a.Control,{disabled:!0,value:n.avanceEsperado}),Object(M.jsx)(Y.a.Append,{children:Object(M.jsx)(Y.a.Text,{children:"%"})}),Object(M.jsx)(v.a.Control.Feedback,{type:"invalid",children:null===(t=f.avance)||void 0===t?void 0:t.message})]})]}),Object(M.jsxs)(v.a.Group,{as:x.a,sm:3,children:[Object(M.jsx)(v.a.Label,{children:"Avance"}),Object(M.jsxs)(Y.a,{hasValidation:!0,children:[Object(M.jsx)(v.a.Control,Object(h.a)({isInvalid:!!f.avance},b("avance"))),Object(M.jsx)(Y.a.Append,{children:Object(M.jsx)(Y.a.Text,{children:"%"})}),Object(M.jsx)(v.a.Control.Feedback,{type:"invalid",children:null===(a=f.avance)||void 0===a?void 0:a.message})]})]})]}),Object(M.jsx)(v.a.Group,{children:Object(M.jsx)(v.a.File,Object(h.a)({label:"Informe"},b("informe")))}),Object(M.jsxs)(v.a.Group,{children:[Object(M.jsx)(v.a.Label,{children:"Observaciones"}),Object(M.jsx)(v.a.Control,Object(h.a)({as:"textarea"},b("observaciones")))]})]})}),Object(M.jsx)(ce.a.Footer,{children:Object(M.jsxs)(m.a,{type:"submit",form:"avance-form",children:[p.isLoading?Object(M.jsx)(O.a,{animation:"border",className:"mr-2",size:"sm"}):null,Object(M.jsx)("span",{className:"align-middle",children:"Guardar"})]})})]}))},re=a(689),se=function(e){var t=e.avance,a=Object(r.i)(),c=(parseInt(a.planId),parseInt(a.actividadId),Object(D.b)("pdfModal"));return Object(M.jsxs)(z.a,{style:{position:"initial"},children:[Object(M.jsx)(z.a.Toggle,{as:N.j,variant:"link",id:"dropdown-historial-".concat(t.id)}),Object(M.jsx)(z.a.Menu,{children:Object(M.jsx)(o.b,{authorize:function(){return!0},children:Object(M.jsxs)(z.a.Item,{onClick:function(){c.open({title:"Informe",url:t.informeUrl})},children:[Object(M.jsx)(re.a,{className:"mr-2"}),"Ver informe"]})})})]})},de={scales:{yAxes:[{ticks:{beginAtZero:!0},min:0,max:100}]}},le=i.a.memo((function(e){return Object(M.jsx)(ae.a,Object(h.a)({},e))})),oe=function(){Object(r.g)();var e=Object(r.i)(),t=parseInt(e.planId),a=parseInt(e.actividadId),c=Object(n.useState)(!1),i=Object(u.a)(c,2),s=i[0],l=i[1],o=function(e,t,a){return G(e,Object(h.a)({select:function(e){var a;return(null===(a=e.data.actividades)||void 0===a?void 0:a.find((function(e){return e.id==t})))||null}},a))}(t,a),j=o.data;console.log("Actividad",o);var b=function(){var e=[],t=j.historial.length&&W()(j.historial[0].fecha),a=j.historial.length&&W()(j.historial[j.historial.length-1].fecha),c=W()(j.inicio).subtract(1,"days"),n=W()(j.fin),i=W()();n=i.isBefore(n)?i:n;for(var r=!t||c.isBefore(t)?c:t,s=!a||n.isAfter(a)?n:a,d=0;r.isSameOrBefore(s);){var l=j.historial.filter((function(e){return e.fecha==r.format("YYYY-MM-DD")})),o=l[l.length-1];d=o?o.actual:d,e.push(d),r.add(1,"days")}return e},O=function(){for(var e=[],t=W()(j.inicio).startOf("day").subtract(1,"days"),a=W()(j.fin),c=W.a.duration(a.diff(t)).asDays(),n=j.historial.length&&W()(j.historial[0].fecha),i=j.historial.length&&W()(j.historial[j.historial.length-1].fecha),r=(!n||t.isBefore(n)?t:n).clone(),s=(!i||a.isAfter(i)?a:i).clone();r.isSameOrBefore(s);){var d=W.a.duration(r.diff(t)).asDays();e.push(Math.min(100,Math.max(0,Math.round(1e4*d/c)/100))),r.add(1,"days")}return e},v=Object(n.useMemo)((function(){if(j)return{labels:function(){var e=[],t=j.historial.length&&W()(j.historial[0].fecha),a=j.historial.length&&W()(j.historial[j.historial.length-1].fecha),c=W()(j.inicio).subtract(1,"days"),n=W()(j.fin),i=W()();n=i.isAfter(n)?i:n;for(var r=!t||c.isBefore(t)?c:t,s=!a||n.isAfter(a)?n:a;r.isSameOrBefore(s);)e.push(r.format("Do MMM")),r.add(1,"days");return e}(),datasets:[{label:"Avance real",data:b(),fill:!1,backgroundColor:"rgb(255, 99, 132)",borderColor:"rgba(255, 99, 132, 0.2)"},{label:"Avance Esperado",data:O(),borderDash:[5,5],fill:!1,backgroundColor:"rgb(53, 54, 95)",borderColor:"rgba(53, 54, 95, 0.2)"}]}}),[j]);return Object(M.jsxs)(M.Fragment,{children:[Object(M.jsx)("h1",{style:{fontSize:"1.5rem"},children:"Actividad"}),Object(M.jsxs)(g.a,{children:[Object(M.jsx)(x.a,{className:"mb-3",children:Object(M.jsxs)(_.a,{style:{height:"100%"},children:[Object(M.jsx)(_.a.Header,{children:"Informaci\xf3n"}),Object(M.jsx)(_.a.Body,{children:Object(M.jsxs)("dl",{className:"form-row",children:[Object(M.jsx)("dt",{className:"col-sm-3",children:"Nombre"}),Object(M.jsx)("dd",{className:"col-sm-9",children:o.isFetching?Object(M.jsx)($.a,{}):null===j||void 0===j?void 0:j.nombre}),Object(M.jsx)("dt",{className:"col-sm-3",children:"Fecha de inicio"}),Object(M.jsx)("dd",{className:"col-sm-9",children:o.isFetching?Object(M.jsx)($.a,{}):"".concat(W()(null===j||void 0===j?void 0:j.inicio).format("L"))}),Object(M.jsx)("dt",{className:"col-sm-3",children:"Fecha de conclusi\xf3n"}),Object(M.jsx)("dd",{className:"col-sm-9",children:"".concat(W()(null===j||void 0===j?void 0:j.fin).format("L")," (").concat(W()(null===j||void 0===j?void 0:j.fin).locale("es").fromNow(),")")}),Object(M.jsx)("dt",{className:"col-sm-3",children:"Avanve"}),Object(M.jsxs)("dd",{className:"col-sm-9",children:[null===j||void 0===j?void 0:j.avance,"%"]}),Object(M.jsx)("dt",{className:"col-sm-3",children:"Avance esperado"}),Object(M.jsxs)("dd",{className:"col-sm-9",children:[null===j||void 0===j?void 0:j.avanceEsperado,"%"]})]})})]})}),Object(M.jsx)(x.a,{className:"mb-3",children:Object(M.jsxs)(_.a,{style:{height:"100%"},children:[Object(M.jsx)(_.a.Header,{children:"Gr\xe1fico"}),Object(M.jsx)(_.a.Body,{children:v&&Object(M.jsx)(le,{data:v,options:de,type:"line"})})]})})]}),Object(M.jsxs)(_.a,{children:[Object(M.jsx)(_.a.Header,{children:"Historial de avance"}),Object(M.jsxs)(_.a.Body,{children:[Object(M.jsx)("div",{className:"d-flex mb-2",children:Object(M.jsx)(m.a,{className:"ml-auto",onClick:function(){l(!0)},children:Object(M.jsx)(d.h,{})})}),Object(M.jsxs)(p.a,{children:[Object(M.jsx)("thead",{children:Object(M.jsxs)("tr",{children:[Object(M.jsx)("th",{children:"#"}),Object(M.jsx)("th",{children:"Fecha"}),Object(M.jsx)("th",{style:{width:110},children:"Avance"}),Object(M.jsx)("th",{children:"Observaciones"}),Object(M.jsx)("th",{style:{width:1}})]})}),Object(M.jsx)("tbody",{children:null===j||void 0===j?void 0:j.historial.map((function(e,t){return Object(M.jsxs)("tr",{children:[Object(M.jsx)("th",{scope:"row",children:t+1}),Object(M.jsx)("td",{className:"text-nowrap",children:W()(e.fecha).format("L")}),Object(M.jsx)("td",{children:Object(M.jsxs)("div",{className:"text-center",children:[Object(M.jsx)("div",{children:"".concat(e.actual,"%/").concat(e.esperado,"%")}),Object(M.jsx)("div",{className:e.actual>=e.esperado?"bg-success":W()().isBefore(W()(j.fin))?"bg-warning":"bg-danger",style:{width:"".concat(e.actual,"%"),overflow:"hidden",position:"relative",top:"-1.5rem"},children:Object(M.jsx)("div",{className:"text-white",style:{width:110},children:"".concat(e.actual,"%/").concat(e.esperado,"%")})})]})}),Object(M.jsx)("td",{children:e.observaciones}),Object(M.jsx)("td",{children:Object(M.jsx)(se,{avance:e})})]},e.id)}))})]}),Object(M.jsx)("div",{className:"d-flex mb-2",children:Object(M.jsx)(m.a,{className:"ml-auto",onClick:function(){l(!0)},children:Object(M.jsx)(d.h,{})})}),j&&Object(M.jsx)(ie,{actividad:j,show:s,onHide:function(){return l(!1)}})]})]})]})},je=function(){var e,t=Object(r.j)(),a=Object(b.e)(t.url),c=Object(r.h)(),i=Object(j.a)(),h=Object(n.useMemo)((function(){var e=[];return e.push({id:"planes",icon:Object(M.jsx)(d.l,{}),path:"".concat(a,"/planes"),title:"Planes"}),e}),[i]),u=(null===(e=c.state)||void 0===e?void 0:e.background)||c;return Object(M.jsx)(l.a,{sidebar:{header:Object(M.jsx)("div",{className:"d-flex justify-content-center",children:Object(M.jsx)(s.a,{src:"/logo-lg.png"})}),items:h},children:Object(M.jsxs)(r.d,{location:u,children:[Object(M.jsx)(o.c,{exact:!0,path:"".concat(a,"/planes"),children:Object(M.jsx)(T,{})}),Object(M.jsx)(o.c,{exact:!0,path:["".concat(a,"/planes/registrar")],children:Object(M.jsx)(Z,{})}),Object(M.jsx)(o.c,{path:"".concat(a,"/planes/:planId/actividades/:actividadId"),children:Object(M.jsx)(oe,{})}),Object(M.jsx)(o.c,{exact:!0,path:"".concat(a,"/planes/:planId"),children:Object(M.jsx)(te,{})})]})})};t.default=je}}]);
//# sourceMappingURL=7.c226d31d.chunk.js.map